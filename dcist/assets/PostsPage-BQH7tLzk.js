import{c as S,r as p,j as e,C as M,b as A,B as N,X as L,t as c,x as _,H as I,I as w}from"./index-B5GP4ZU0.js";import{A as k,a as U}from"./avatar-AVFod3uN.js";import{T}from"./textarea-DqFXOEs1.js";import{L as P}from"./label-k4a1c30R.js";import{I as R}from"./ImageWithFallback-CPTj3iC7.js";import{I as z}from"./image-modal-c-Ha-HLI.js";import{I as O}from"./image-hr9zOed5.js";import{P as $}from"./PostCard-kJ6wFUuf.js";import{f as W}from"./format-MGXwiYcE.js";import"./dialog-D8fBtqfZ.js";import"./separator-D-SV_8Ad.js";import"./ellipsis-vertical-BPQDY5HV.js";import"./heart-5VJOFeSd.js";const D=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],G=S("smile",D);const Y=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],E=S("video",Y),F={IMAGE_MAX_SIZE:2*1024*1024,ACCEPTED_IMAGE_TYPES:[".pdf",".jpg",".jpeg",".png"]},B=(a,d)=>a.size<=d,V=(a,d)=>{const m="."+a.name.split(".").pop()?.toLowerCase();return d.includes(m)};function X({authorName:a,authorRole:d,onSubmit:m}){const[h,x]=p.useState(""),[r,g]=p.useState([]),[j,y]=p.useState(!1),[s,o]=p.useState(0),i=t=>{const n=t.target.files;if(!n)return;const f=[];Array.from(n).forEach(l=>{const C=l.type.startsWith("video/")?[".mp4",".mov",".avi"]:[...F.ACCEPTED_IMAGE_TYPES];if(!V(l,C)){c.error(`Invalid file type: ${l.name}`);return}const b=l.type.startsWith("video/")?10*1024*1024:F.IMAGE_MAX_SIZE;if(!B(l,b)){c.error(`File too large: ${l.name}. Max size: ${b/1024/1024}MB`);return}f.push({type:l.type.startsWith("video/")?"video":"image",url:URL.createObjectURL(l),file:l})}),f.length>0&&g([...r,...f])},u=t=>{const n=[...r];URL.revokeObjectURL(n[t].url),n.splice(t,1),g(n)},v=()=>{(h.trim()||r.length>0)&&(m?.({content:h,media:r}),x(""),r.forEach(t=>URL.revokeObjectURL(t.url)),g([]))};return e.jsxs(M,{children:[e.jsxs(A,{className:"p-4",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsx(k,{children:e.jsx(U,{className:"bg-[#FF9933]/10 text-[#FF9933]",children:a.split(" ").map(t=>t[0]).join("")})}),e.jsxs("div",{children:[e.jsx("h4",{children:a}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(T,{placeholder:"What's happening in your Panchayat? Share updates, announcements, or achievements...",value:h,onChange:t=>x(t.target.value),rows:4,className:"resize-none border-0 p-0 focus-visible:ring-0"})}),r.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:`grid gap-2 ${r.length===1?"grid-cols-1":r.length===2?"grid-cols-2":"grid-cols-3"}`,children:r.map((t,n)=>{const f=r.slice(0,n).filter(l=>l.type==="image").length;return e.jsxs("div",{className:"group relative aspect-square overflow-hidden rounded-lg bg-muted",children:[t.type==="image"?e.jsx("div",{className:"h-full w-full cursor-pointer",onClick:()=>{o(f),y(!0)},children:e.jsx(R,{src:t.url,alt:`Upload ${n+1}`,className:"h-full w-full object-cover"})}):e.jsxs("div",{className:"relative h-full w-full",children:[e.jsx("video",{src:t.url,className:"h-full w-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:e.jsx(E,{className:"h-8 w-8 text-white"})})]}),e.jsx(N,{variant:"destructive",size:"icon",className:"absolute right-2 top-2 h-8 w-8 opacity-0 transition-opacity group-hover:opacity-100",onClick:()=>u(n),children:e.jsx(L,{className:"h-4 w-4"})})]},n)})})}),e.jsxs("div",{className:"flex items-center justify-between border-t pt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(P,{htmlFor:"photo-upload",children:[e.jsxs("div",{className:"flex cursor-pointer items-center gap-2 rounded-lg px-3 py-2 transition-colors hover:bg-muted",children:[e.jsx(O,{className:"h-5 w-5 text-[#138808]"}),e.jsx("span",{className:"text-sm",children:"Photo"})]}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:i})]}),e.jsxs(P,{htmlFor:"video-upload",children:[e.jsxs("div",{className:"flex cursor-pointer items-center gap-2 rounded-lg px-3 py-2 transition-colors hover:bg-muted",children:[e.jsx(E,{className:"h-5 w-5 text-[#FF9933]"}),e.jsx("span",{className:"text-sm",children:"Video"})]}),e.jsx("input",{id:"video-upload",type:"file",accept:"video/*",multiple:!0,className:"hidden",onChange:i})]}),e.jsx(N,{variant:"ghost",size:"sm",className:"flex items-center gap-2",children:e.jsx(G,{className:"h-5 w-5 text-muted-foreground"})})]}),e.jsx(N,{onClick:v,disabled:!h.trim()&&r.length===0,className:"bg-[#FF9933] hover:bg-[#FF9933]/90",children:"Post"})]})]}),r.filter(t=>t.type==="image").length>0&&e.jsx(z,{isOpen:j,onClose:()=>y(!1),imageUrl:r.filter(t=>t.type==="image")[s]?.url||"",alt:`Upload ${s+1}`,images:r.filter(t=>t.type==="image").map(t=>t.url),currentIndex:s,onIndexChange:o})]})}function ne(){const{user:a}=_(),[d,m]=p.useState([]),[h,x]=p.useState(!0);p.useEffect(()=>{a?.panchayatId&&r()},[a]);const r=async()=>{if(a?.panchayatId){x(!0);try{const s=await I.list({pageSize:50}),o=String(a.panchayatId),i=s.items.filter(u=>u.panchayatId?String(u.panchayatId)===o:!1);m(i)}catch(s){console.error("Error fetching posts:",s),c.error("Failed to load posts")}finally{x(!1)}}},g=async s=>{if(!a){c.error("You need to be logged in to create posts.");return}try{const i=s.media[0]?.file,u=await I.create({title:s.content.slice(0,60)||"Panchayat update",bodyText:s.content||"Shared an update",imageFile:i});m(v=>[u,...v]),a.panchayatId&&w.invalidate(a.panchayatId),c.success("Post published successfully!")}catch(o){const i=o instanceof Error?o.message:"Failed to create post";c.error(i)}},j=async s=>{c.info("Edit post feature coming soon!")},y=async s=>{if(a?.panchayatId)try{await I.delete(s),m(o=>o.filter(i=>i.id!==s)),w.invalidate(a.panchayatId),c.success("Post deleted successfully!")}catch(o){const i=o instanceof Error?o.message:"Failed to delete post";c.error(i)}};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-2 sm:gap-0 sm:items-center sm:justify-between sm:flex-row",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Community Posts"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Share updates, photos, and videos with your community"})]})}),e.jsx(X,{authorName:a?.name||"User",authorRole:a?.role||"Sachiv",onSubmit:g}),e.jsxs("div",{children:[e.jsx("h3",{className:"mb-3 sm:mb-4 text-base sm:text-lg font-semibold",children:"Your Posts"}),h?e.jsx("div",{className:"text-center text-muted-foreground py-8 text-sm",children:"Loading posts..."}):e.jsx("div",{className:"space-y-4 sm:space-y-6",children:d.length===0?e.jsx("div",{className:"text-center text-muted-foreground py-8 text-sm",children:"No posts yet. Create your first post!"}):d.map(s=>e.jsx($,{post:{...s,timestamp:W(new Date(s.timestamp))},showActions:!0,onEdit:j,onDelete:y},s.id))})]})]})}export{ne as PostsPage};
