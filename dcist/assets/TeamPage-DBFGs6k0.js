import{r as o,ai as N,t as i,j as e,B as c,C as q,d as te,e as ie,f as re,b as B,D as le,n as ne,o as de,q as S,X as z,x as ce}from"./index-B5GP4ZU0.js";import{I as l}from"./input-C4RtHFee.js";import{L as n}from"./label-k4a1c30R.js";import{D as O,a as G,b as H,c as $,d as J,e as Q}from"./dialog-D8fBtqfZ.js";import{T as oe,a as me,b as A,c as j,d as he,e as u}from"./table-BDHQV-gI.js";import{B as V}from"./badge-ALW9Fyqs.js";import{A as xe,a as ue}from"./alert-DzbQG6nj.js";import{f as W}from"./format-MGXwiYcE.js";import{P as pe}from"./plus-BdOJHdON.js";import{S as ge}from"./shield-CUjFhZuP.js";import{S as X,T as K}from"./trash-2-Dvt3QX8d.js";import{E as je}from"./ellipsis-vertical-BPQDY5HV.js";function ve({panchayatId:w}){const[p,Y]=o.useState([]),[Z,T]=o.useState(!0),[_,b]=o.useState(!1),[ee,C]=o.useState(!1),[F,I]=o.useState(null),[a,d]=o.useState({name:"",email:"",phone:"",password:"",designation:""}),[M,m]=o.useState(null),[D,h]=o.useState(""),[E,g]=o.useState("");o.useEffect(()=>{v()},[w]);const v=async()=>{T(!0);try{const s=await N.list({size:20});Y(s.items)}catch{i.error("Failed to load team members")}finally{T(!1)}},f=()=>{d({name:"",email:"",phone:"",password:"",designation:""}),m(null),h(""),g(""),I(null)},U=s=>{const t=s.target.files?.[0];if(t){if(t.size>5*1024*1024){i.error("Image size must be less than 5MB");return}if(!t.type.startsWith("image/")){i.error("Please select an image file");return}m(t);const r=new FileReader;r.onloadend=()=>{h(r.result)},r.readAsDataURL(t),g("")}},se=async s=>{if(s?.preventDefault(),!a.name||!a.email||!a.phone||!a.password){i.error("Please fill all required fields");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)){i.error("Please enter a valid email address");return}if(!/^\d{10}$/.test(a.phone)){i.error("Phone number must be exactly 10 digits");return}if(a.password.length<8){i.error("Password must be at least 8 characters");return}try{await N.addMember({name:a.name,email:a.email,phone:a.phone,password:a.password,designation:a.designation||void 0,imageFile:M||void 0,imageUrl:E||void 0,compressionQuality:"HIGH"}),i.success("Team member added successfully"),b(!1),f(),v()}catch(r){i.error(r.message||"Failed to add team member")}},k=s=>{I(s),d({name:s.name,email:s.email,phone:s.phone||"",password:"",designation:s.designation||""}),g(s.image||""),m(null),h(s.image||""),C(!0)},ae=async s=>{if(s?.preventDefault(),!F)return;if(!a.name||!a.email||!a.phone){i.error("Please fill all required fields");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)){i.error("Please enter a valid email address");return}if(!/^\d{10}$/.test(a.phone)){i.error("Phone number must be exactly 10 digits");return}if(a.password&&a.password.length<8){i.error("Password must be at least 8 characters");return}try{await N.updateMember(F.id,{name:a.name,email:a.email,phone:a.phone,password:a.password||void 0,designation:a.designation||void 0,imageFile:M||void 0,imageUrl:E||void 0,compressionQuality:"HIGH"}),i.success("Team member updated successfully"),C(!1),f(),v()}catch(r){i.error(r.message||"Failed to update team member")}},R=async s=>{if(confirm("Are you sure you want to remove this team member?"))try{await N.removeMember(s),i.success("Team member removed successfully"),v()}catch{i.error("Failed to remove team member")}},L=async(s,t)=>{try{await N.updateStatus(s,t),i.success(`Member ${t==="active"?"activated":"deactivated"} successfully`),v()}catch{i.error("Failed to update member status")}},P=p.length>=4;return Z?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#FF9933] mx-auto"}),e.jsx("p",{className:"mt-4 text-[#666]",children:"Loading team members..."})]})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-[#1B2B5E]",children:"Team Management"}),e.jsx("p",{className:"text-sm sm:text-base text-[#666] mt-1",children:"Manage your panchayat admin team (Max 4 admins)"})]}),e.jsxs(c,{onClick:()=>{f(),b(!0)},disabled:P,className:"w-full sm:w-auto",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Add Member"]})]}),P&&e.jsxs(xe,{children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx(ue,{children:"Maximum of 4 admins reached. Remove a member to add a new one."})]}),e.jsxs(q,{children:[e.jsxs(te,{children:[e.jsxs(ie,{children:["Team Members (",p.length,"/4)"]}),e.jsx(re,{children:"Current team members with admin access"})]}),e.jsxs(B,{children:[e.jsx("div",{className:"block sm:hidden space-y-3",children:p.length===0?e.jsx("div",{className:"text-center py-8 text-[#666] text-sm",children:"No team members yet. Add your first team member."}):p.map(s=>e.jsx(q,{children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.hasImage&&s.image?e.jsx("img",{src:s.image,alt:s.name,className:"h-12 w-12 rounded-full object-cover",onError:t=>{const r=t.target;r.style.display="none";const y=r.parentElement;if(y){const x=document.createElement("div");x.className="h-12 w-12 rounded-full bg-[#FF9933] flex items-center justify-center text-white font-semibold text-sm",x.textContent=s.initials||s.name.charAt(0).toUpperCase(),y.appendChild(x)}}}):e.jsx("div",{className:"h-12 w-12 rounded-full bg-[#FF9933] flex items-center justify-center text-white font-semibold text-sm",children:s.initials||s.name.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:s.name}),s.role&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.role})]}),e.jsx(V,{variant:s.status==="active"?"default":"secondary",className:"text-xs",children:s.status})]}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsx("div",{className:"truncate",children:s.email}),s.designation&&e.jsxs("div",{children:["Designation: ",s.designation]}),e.jsxs("div",{children:["Added: ",W(s.createdAt)]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(c,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>k(s),children:[e.jsx(X,{className:"mr-2 h-3 w-3"}),"Edit"]}),e.jsx(c,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>L(s.id,s.status==="active"?"inactive":"active"),children:s.status==="active"?"Deactivate":"Activate"}),e.jsxs(c,{variant:"outline",size:"sm",className:"flex-1 text-destructive",onClick:()=>R(s.id),children:[e.jsx(K,{className:"mr-2 h-3 w-3"}),"Remove"]})]})]})})},s.id))}),e.jsx("div",{className:"hidden sm:block overflow-x-auto",children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsxs(A,{children:[e.jsx(j,{children:"Member"}),e.jsx(j,{children:"Email"}),e.jsx(j,{children:"Designation"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Added"}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(he,{children:p.length===0?e.jsx(A,{children:e.jsx(u,{colSpan:6,className:"text-center py-8 text-[#666]",children:"No team members yet. Add your first team member."})}):p.map(s=>e.jsxs(A,{children:[e.jsx(u,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.hasImage&&s.image?e.jsx("img",{src:s.image,alt:s.name,className:"h-10 w-10 rounded-full object-cover",onError:t=>{const r=t.target;r.style.display="none";const y=r.parentElement;if(y){const x=document.createElement("div");x.className="h-10 w-10 rounded-full bg-[#FF9933] flex items-center justify-center text-white font-semibold text-sm",x.textContent=s.initials||s.name.charAt(0).toUpperCase(),y.appendChild(x)}}}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-[#FF9933] flex items-center justify-center text-white font-semibold text-sm",children:s.initials||s.name.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.role&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.role})]})]})}),e.jsx(u,{children:s.email}),e.jsx(u,{children:s.designation||"-"}),e.jsx(u,{children:e.jsx(V,{variant:s.status==="active"?"default":"secondary",children:s.status})}),e.jsx(u,{children:W(s.createdAt)}),e.jsx(u,{className:"text-right",children:e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(de,{align:"end",children:[e.jsxs(S,{onClick:()=>k(s),children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(S,{onClick:()=>L(s.id,s.status==="active"?"inactive":"active"),children:s.status==="active"?"Deactivate":"Activate"}),e.jsxs(S,{className:"text-red-600",onClick:()=>R(s.id),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]})})]},s.id))})]})})]})]}),e.jsx(O,{open:_,onOpenChange:b,children:e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsxs(H,{children:[e.jsx($,{children:"Add Team Member"}),e.jsx(J,{children:"Add a new admin to your panchayat team. Maximum 4 admins allowed."})]}),e.jsxs("form",{onSubmit:se,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Name *"}),e.jsx(l,{id:"name",placeholder:"Enter full name",value:a.name,onChange:s=>d({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"Email *"}),e.jsx(l,{id:"email",type:"email",placeholder:"Enter email address",value:a.email,onChange:s=>d({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phone",children:"Phone *"}),e.jsx(l,{id:"phone",type:"tel",placeholder:"Enter 10-digit phone number",value:a.phone,onChange:s=>d({...a,phone:s.target.value.replace(/\D/g,"").substring(0,10)}),maxLength:10,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"designation",children:"Designation"}),e.jsx(l,{id:"designation",placeholder:"e.g., Panchayat Sachiv, Deputy Sachiv",value:a.designation,onChange:s=>d({...a,designation:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"password",children:"Password *"}),e.jsx(l,{id:"password",type:"password",placeholder:"Enter password (min 8 characters)",value:a.password,onChange:s=>d({...a,password:s.target.value}),required:!0,minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"image",children:"Profile Image (Optional)"}),e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{id:"image",type:"file",accept:"image/*",onChange:U,className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 5MB. JPG, PNG, or GIF"})]}),D&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:D,alt:"Preview",className:"h-20 w-20 rounded-full object-cover border-2 border-gray-200"}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-red-500 text-white hover:bg-red-600",onClick:()=>{m(null),h("")},children:e.jsx(z,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(n,{htmlFor:"imageUrl",className:"text-xs text-muted-foreground",children:"Or enter image URL:"}),e.jsx(l,{id:"imageUrl",type:"url",placeholder:"https://example.com/image.jpg",value:E,onChange:s=>{g(s.target.value),s.target.value&&(m(null),h(""))},disabled:!!M})]})]}),e.jsxs(Q,{children:[e.jsx(c,{variant:"outline",type:"button",onClick:()=>{b(!1),f()},children:"Cancel"}),e.jsx(c,{type:"submit",disabled:P,children:"Add Member"})]})]})]})}),e.jsx(O,{open:ee,onOpenChange:C,children:e.jsxs(G,{className:"max-w-2xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsxs(H,{children:[e.jsx($,{children:"Edit Team Member"}),e.jsx(J,{children:"Update team member information."})]}),e.jsxs("form",{onSubmit:ae,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-name",children:"Name *"}),e.jsx(l,{id:"edit-name",placeholder:"Enter full name",value:a.name,onChange:s=>d({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-email",children:"Email *"}),e.jsx(l,{id:"edit-email",type:"email",placeholder:"Enter email address",value:a.email,onChange:s=>d({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(l,{id:"edit-phone",type:"tel",placeholder:"Enter 10-digit phone number",value:a.phone,onChange:s=>d({...a,phone:s.target.value.replace(/\D/g,"").substring(0,10)}),maxLength:10,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-designation",children:"Designation"}),e.jsx(l,{id:"edit-designation",placeholder:"e.g., Panchayat Sachiv, Deputy Sachiv",value:a.designation,onChange:s=>d({...a,designation:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-password",children:"New Password (Leave blank to keep current)"}),e.jsx(l,{id:"edit-password",type:"password",placeholder:"Enter new password (min 8 characters)",value:a.password,onChange:s=>d({...a,password:s.target.value}),minLength:8})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-image",children:"Profile Image"}),e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{id:"edit-image",type:"file",accept:"image/*",onChange:U,className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Max 5MB. JPG, PNG, or GIF"})]}),(D||F?.image)&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:D||F?.image,alt:"Preview",className:"h-20 w-20 rounded-full object-cover border-2 border-gray-200"}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full bg-red-500 text-white hover:bg-red-600",onClick:()=>{m(null),h(""),g("")},children:e.jsx(z,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(n,{htmlFor:"edit-imageUrl",className:"text-xs text-muted-foreground",children:"Or enter image URL:"}),e.jsx(l,{id:"edit-imageUrl",type:"url",placeholder:"https://example.com/image.jpg",value:E,onChange:s=>{g(s.target.value),s.target.value&&(m(null),h(""))},disabled:!!M})]})]}),e.jsxs(Q,{children:[e.jsx(c,{variant:"outline",type:"button",onClick:()=>{C(!1),f()},children:"Cancel"}),e.jsx(c,{type:"submit",children:"Update Member"})]})]})]})})]})}function Ae(){const{user:w}=ce();return w?.panchayatId?e.jsx(ve,{panchayatId:w.panchayatId}):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Loading..."})}export{Ae as TeamPage};
