import{x as U,r as l,S as p,t as n,j as e,B as i,C as g,b as T}from"./index-B5GP4ZU0.js";import{I as R}from"./input-C4RtHFee.js";import{L as w}from"./label-k4a1c30R.js";import{T as V}from"./textarea-DqFXOEs1.js";import{D as M,a as $,b as G,c as J,d as K,e as Q}from"./dialog-D8fBtqfZ.js";import{T as W,a as X,b,c as x,d as Y,e as c}from"./table-BDHQV-gI.js";import{B as S}from"./badge-ALW9Fyqs.js";import{T as Z,a as _,b as A,c as ee}from"./tabs-C4k9DC07.js";import{C as se}from"./circle-plus-B8nn-p_t.js";import{S as k,T as I}from"./trash-2-Dvt3QX8d.js";function xe(){const{user:o}=U(),[u,C]=l.useState([]),[D,F]=l.useState(!0),[h,L]=l.useState("all"),[B,j]=l.useState(!1),[d,y]=l.useState(null),[t,m]=l.useState({title:"",bodyText:"",isActive:!0});l.useEffect(()=>{o?.panchayatId&&v()},[o]);const v=async()=>{if(o?.panchayatId){F(!0);try{const s=await p.list();C(s.items)}catch(s){console.error("Error fetching announcements:",s),n.error("Failed to load announcements")}finally{F(!1)}}},z=()=>{y(null),m({title:"",bodyText:"",isActive:!0}),j(!0)},q=s=>{y(s),m({title:s.title,bodyText:s.description||"",isActive:s.status==="Published"}),j(!0)},N=()=>{j(!1),y(null),m({title:"",bodyText:"",isActive:!0})},H=async s=>{if(s?.preventDefault(),!!o?.panchayatId){if(!t.title.trim()){n.error("Please enter announcement title");return}if(!t.bodyText.trim()){n.error("Please enter announcement content");return}try{await p.create({title:t.title,bodyText:t.bodyText,isActive:t.isActive}),n.success("Announcement created successfully!"),N(),v()}catch(a){const r=a instanceof Error?a.message:"Failed to create announcement";n.error(r)}}},O=async s=>{if(s?.preventDefault(),!(!o?.panchayatId||!d)){if(!t.title.trim()){n.error("Please enter announcement title");return}if(!t.bodyText.trim()){n.error("Please enter announcement content");return}try{await p.update(d.id,{title:t.title,bodyText:t.bodyText,isActive:t.isActive}),n.success("Announcement updated successfully!"),N(),v()}catch(a){const r=a instanceof Error?a.message:"Failed to update announcement";n.error(r)}}},P=s=>{const a=u.find(r=>r.id===s);a&&q(a)},E=async s=>{if(o?.panchayatId&&confirm("Are you sure you want to delete this announcement?"))try{await p.delete(s),C(a=>a.filter(r=>r.id!==s)),n.success("Announcement deleted successfully!")}catch(a){const r=a instanceof Error?a.message:"Failed to delete announcement";n.error(r)}},f=h==="all"?u:h==="published"?u.filter(s=>s.status==="Published"):u.filter(s=>s.status==="Draft");return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Announcements"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Manage your panchayat announcements"})]}),e.jsxs(i,{className:"bg-[#FF9933] hover:bg-[#FF9933]/90 w-full sm:w-auto",onClick:z,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"New Announcement"})]})]}),e.jsxs(Z,{value:h,onValueChange:s=>L(s),children:[e.jsxs(_,{className:"grid w-full grid-cols-3 sm:w-auto",children:[e.jsx(A,{value:"all",className:"text-xs sm:text-sm",children:"All"}),e.jsx(A,{value:"published",className:"text-xs sm:text-sm",children:"Published"}),e.jsx(A,{value:"draft",className:"text-xs sm:text-sm",children:"Drafts"})]}),e.jsxs(ee,{value:h,className:"mt-4 sm:mt-6",children:[e.jsx("div",{className:"block sm:hidden space-y-3",children:D?e.jsx(g,{children:e.jsx(T,{className:"p-6 text-center text-muted-foreground text-sm",children:"Loading..."})}):f.length===0?e.jsx(g,{children:e.jsx(T,{className:"p-6 text-center text-muted-foreground text-sm",children:"No announcements yet"})}):f.map(s=>e.jsx(g,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm mb-1",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.date})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{variant:s.status==="Published"?"default":"secondary",className:`text-xs ${s.status==="Published"?"bg-[#138808]":""}`,children:s.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.views||0," views"]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(i,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>P(s.id),children:[e.jsx(k,{className:"mr-2 h-3 w-3"}),"Edit"]}),e.jsxs(i,{variant:"outline",size:"sm",className:"flex-1 text-destructive",onClick:()=>E(s.id),children:[e.jsx(I,{className:"mr-2 h-3 w-3"}),"Delete"]})]})]})})},s.id))}),e.jsx(g,{className:"hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(X,{children:e.jsxs(b,{children:[e.jsx(x,{children:"Title"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Views"}),e.jsx(x,{className:"text-right",children:"Actions"})]})}),e.jsx(Y,{children:D?e.jsx(b,{children:e.jsx(c,{colSpan:5,className:"text-center text-muted-foreground py-6",children:"Loading..."})}):f.length===0?e.jsx(b,{children:e.jsx(c,{colSpan:5,className:"text-center text-muted-foreground py-6",children:"No announcements yet"})}):f.map(s=>e.jsxs(b,{children:[e.jsx(c,{className:"font-medium",children:s.title}),e.jsx(c,{children:s.date}),e.jsx(c,{children:e.jsx(S,{variant:s.status==="Published"?"default":"secondary",className:s.status==="Published"?"bg-[#138808]":"",children:s.status})}),e.jsx(c,{children:s.views||0}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>P(s.id),children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>E(s.id),children:e.jsx(I,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})]}),e.jsx(M,{open:B,onOpenChange:j,children:e.jsxs($,{className:"max-w-2xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsxs(G,{children:[e.jsx(J,{children:d?"Edit Announcement":"Create New Announcement"}),e.jsx(K,{children:d?"Update the announcement details below":"Fill in the details to create a new announcement"})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),d?O(s):H(s)},className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"title",children:"Title *"}),e.jsx(R,{id:"title",placeholder:"Enter announcement title",value:t.title,onChange:s=>m({...t,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"bodyText",children:"Content *"}),e.jsx(V,{id:"bodyText",placeholder:"Enter announcement content",value:t.bodyText,onChange:s=>m({...t,bodyText:s.target.value}),rows:6,required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:t.isActive,onChange:s=>m({...t,isActive:s.target.checked}),className:"h-4 w-4 rounded border-gray-300"}),e.jsx(w,{htmlFor:"isActive",className:"cursor-pointer",children:"Publish immediately (uncheck to save as draft)"})]}),e.jsxs(Q,{children:[e.jsx(i,{type:"button",variant:"outline",onClick:N,children:"Cancel"}),e.jsx(i,{type:"submit",className:"bg-[#FF9933] hover:bg-[#FF9933]/90",children:d?"Update":"Create"})]})]})]})})]})}export{xe as AnnouncementsPage};
