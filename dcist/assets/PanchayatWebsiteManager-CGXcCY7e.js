import{a as J,r as i,aB as h,t as o,j as e,B as m,C as I,b as V}from"./index-B5GP4ZU0.js";import{B as M}from"./badge-ALW9Fyqs.js";import{D as X,a as Z,b as ee,c as te,d as se}from"./dialog-D8fBtqfZ.js";import{I as ae}from"./input-C4RtHFee.js";import{S as U,a as A,b as L,c as R,d as b}from"./select-dEcH2o1V.js";import{S as le,G as re,C as ie}from"./SectionEditor-nBt1O9M1.js";import{D as ne}from"./DynamicSectionRenderer-DnALxJmT.js";import{p as oe,i as ce,I as me}from"./ImageWithFallback-CPTj3iC7.js";import{P as B}from"./plus-BdOJHdON.js";import{S as de}from"./search-JXwptwBL.js";import{F as xe}from"./funnel-Cii8H73m.js";import{E as P}from"./eye-BsbdD2Tc.js";import{E as pe}from"./eye-off-pVSqCzBV.js";import{S as he,T as ue}from"./trash-2-Dvt3QX8d.js";import"./check-BfJ-MShT.js";import"./label-k4a1c30R.js";import"./textarea-DqFXOEs1.js";import"./checkbox-sHSxgcd9.js";import"./images-DNiRzA5N.js";import"./list-CUSQgfHx.js";import"./tabs-C4k9DC07.js";import"./upload-wi-AKsz6.js";import"./clock-C1_AbEPp.js";import"./trending-up-CPnljwFl.js";import"./building-2-Dv7kGGrs.js";import"./users-BuGIPw5K.js";function ge({section:s,index:r,onEdit:S,onDelete:u,onToggleVisibility:T,onDuplicate:E,onDragStart:v,onDragOver:N,onDrop:d,isDragging:g}){const[x,c]=i.useState(!1),w=n=>({HERO:"bg-blue-100 text-blue-800",HERO_BANNER:"bg-blue-100 text-blue-800",STATS:"bg-green-100 text-green-800",STATISTICS_SECTION:"bg-green-100 text-green-800",GALLERY:"bg-purple-100 text-purple-800",IMAGE_GALLERY:"bg-purple-100 text-purple-800",FAQ:"bg-orange-100 text-orange-800",FAQ_SECTION:"bg-orange-100 text-orange-800",FORM:"bg-pink-100 text-pink-800",FORM_SECTION:"bg-pink-100 text-pink-800",VIDEO:"bg-red-100 text-red-800",VIDEO_SECTION:"bg-red-100 text-red-800",TESTIMONIALS:"bg-yellow-100 text-yellow-800",TESTIMONIALS_SECTION:"bg-yellow-100 text-yellow-800",FEATURES:"bg-indigo-100 text-indigo-800",FEATURES_GRID:"bg-indigo-100 text-indigo-800",CARDS:"bg-teal-100 text-teal-800",CARD_SECTION:"bg-teal-100 text-teal-800"})[n]||"bg-gray-100 text-gray-800";return e.jsx("div",{draggable:!0,onDragStart:n=>v(n,r),onDragOver:N,onDrop:n=>d(n,r),className:`bg-white rounded-lg border-2 transition-all ${g?"border-primary opacity-50":"border-[#E5E5E5] hover:border-primary/50"}`,children:e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-shrink-0",children:[e.jsx("div",{className:"cursor-move text-muted-foreground hover:text-primary",children:e.jsx(re,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 rounded border border-[#E5E5E5] overflow-hidden bg-gray-50 flex items-center justify-center",children:s.imageUrl?e.jsx(me,{src:s.imageUrl,alt:s.title||s.sectionType,className:"w-full h-full object-cover"}):e.jsx("div",{className:`w-full h-full flex items-center justify-center ${w(s.sectionType)}`,children:e.jsx("span",{className:"text-[10px] sm:text-xs font-semibold",children:s.sectionType.substring(0,3)})})})]}),e.jsxs("div",{className:"flex-1 min-w-0 w-full sm:w-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-1.5 sm:gap-2 flex-wrap",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold truncate",children:s.title||s.sectionType}),e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[e.jsx(M,{variant:"outline",className:`text-[10px] sm:text-xs ${w(s.sectionType)}`,children:s.sectionType}),e.jsx(M,{variant:"outline",className:"text-[10px] sm:text-xs",children:s.layoutType}),!s.isVisible&&e.jsx(M,{variant:"secondary",className:"text-[10px] sm:text-xs",children:"Hidden"})]})]}),s.subtitle&&e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1 truncate",children:s.subtitle}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 mt-1.5 sm:mt-2 text-[10px] sm:text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{children:["Order: ",s.displayOrder]}),s.content?.items&&e.jsxs("span",{children:["â€¢ ",s.content.items.length," item",s.content.items.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 sm:gap-1 flex-shrink-0 w-full sm:w-auto justify-end sm:justify-start",children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>c(!x),title:"Preview",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:e.jsx(P,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>T(s.id),title:s.isVisible?"Hide":"Show",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:s.isVisible?e.jsx(P,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"}):e.jsx(pe,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>E(s.id),title:"Duplicate",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:e.jsx(ie,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>S(s),title:"Edit",className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:e.jsx(he,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>u(s.id),className:"text-destructive hover:text-destructive h-8 w-8 sm:h-9 sm:w-9 p-0",title:"Delete",children:e.jsx(ue,{className:"h-3.5 w-3.5 sm:h-4 sm:w-4"})})]})]}),x&&e.jsx("div",{className:"mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-[#E5E5E5]",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 sm:p-4 max-h-48 sm:max-h-64 overflow-auto",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground mb-2",children:"Preview:"}),e.jsx("div",{className:"scale-[0.65] sm:scale-75 origin-top-left",children:e.jsx(ne,{section:s})})]})})]})})}function Ge(){const{t:s}=J(),[r,S]=i.useState([]),[u,T]=i.useState([]),[E,v]=i.useState(!0),[N,d]=i.useState(!1),[g,x]=i.useState(null),[c,w]=i.useState(""),[n,D]=i.useState("all"),[C,k]=i.useState("all"),[y,O]=i.useState(null);i.useEffect(()=>{p()},[]),i.useEffect(()=>{_()},[r,c,n,C]);const _=()=>{let a=[...r];c&&(a=a.filter(t=>t.title?.toLowerCase().includes(c.toLowerCase())||t.sectionType.toLowerCase().includes(c.toLowerCase())||t.subtitle?.toLowerCase().includes(c.toLowerCase()))),n!=="all"&&(a=a.filter(t=>t.sectionType===n)),C!=="all"&&(a=a.filter(t=>C==="visible"?t.isVisible:!t.isVisible)),T(a)},p=async()=>{try{v(!0);const t=(await h.getSections()).map(l=>({...l,content:typeof l.content=="object"?oe(l.content):l.content,imageUrl:l.imageUrl&&!ce(l.imageUrl)?l.imageUrl:null}));S(t.sort((l,j)=>l.displayOrder-j.displayOrder))}catch(a){o.error(s("sectionManagement.noSections",{defaultValue:"Failed to load sections"})+": "+(a.message||"Unknown error"))}finally{v(!1)}},F=()=>{x(null),d(!0)},z=a=>{x(a),d(!0)},G=async a=>{try{let t;return g?t=await h.updateSection(g.id,a):t=await h.createSection(a),d(!1),x(null),await p(),t}catch(t){throw t}},H=async a=>{if(confirm("Are you sure you want to delete this section? This action cannot be undone."))try{await h.deleteSection(a),o.success(s("sectionManagement.sectionDeleted")),await p()}catch(t){o.error(s("sectionManagement.delete",{defaultValue:"Failed to delete section"})+": "+(t.message||"Unknown error"))}},W=async a=>{try{const t=r.find(j=>j.id===a);if(!t)return;const l={sectionType:t.sectionType,title:`${t.title} (Copy)`,subtitle:t.subtitle,content:t.content,layoutType:t.layoutType,displayOrder:r.length,isVisible:!1,backgroundColor:t.backgroundColor,textColor:t.textColor,imageUrl:t.imageUrl,imageKey:t.imageKey,metadata:t.metadata};await h.createSection(l),o.success(s("sectionManagement.sectionDuplicated")),await p()}catch(t){o.error(s("sectionManagement.duplicate",{defaultValue:"Failed to duplicate section"})+": "+(t.message||"Unknown error"))}},Q=async a=>{try{const t=r.find(l=>l.id===a);t&&(await h.toggleVisibility(a,t.isVisible),o.success(s("sectionManagement.visibilityUpdated")),await p())}catch(t){o.error(s("sectionManagement.visibilityUpdated",{defaultValue:"Failed to update visibility"})+": "+(t.message||"Unknown error"))}},$=(a,t)=>{O(t),a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/html",t.toString())},K=a=>{a.preventDefault(),a.dataTransfer.dropEffect="move"},Y=async(a,t)=>{if(a.preventDefault(),y===null||y===t){O(null);return}const l=[...r],j=l[y];l.splice(y,1),l.splice(t,0,j),S(l),O(null);try{for(let f=0;f<l.length;f++)await h.updateOrder(l[f].id,f);o.success(s("sectionManagement.orderUpdated")),await p()}catch(f){o.error(s("sectionManagement.orderUpdated",{defaultValue:"Failed to update order"})+": "+(f.message||"Unknown error")),await p()}},q=Array.from(new Set(r.map(a=>a.sectionType)));return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading sections..."})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold",children:s("sectionManagement.panchayatWebsite.title")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:s("sectionManagement.panchayatWebsite.subtitle")})]}),e.jsxs(m,{onClick:F,className:"w-full sm:w-auto",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),s("sectionManagement.createSection")]})]}),r.length>0&&e.jsx(I,{children:e.jsx(V,{className:"p-3 sm:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ae,{placeholder:s("sectionManagement.searchSections"),value:c,onChange:a=>w(a.target.value),className:"pl-10 text-sm sm:text-base"})]}),e.jsxs(U,{value:n,onValueChange:D,children:[e.jsxs(A,{className:"w-full sm:w-[180px] text-sm sm:text-base",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),e.jsx(L,{placeholder:s("sectionManagement.filterByType")})]}),e.jsxs(R,{children:[e.jsx(b,{value:"all",children:"All Types"}),q.map(a=>e.jsx(b,{value:a,children:a},a))]})]}),e.jsxs(U,{value:C,onValueChange:k,children:[e.jsx(A,{className:"w-full sm:w-[180px] text-sm sm:text-base",children:e.jsx(L,{placeholder:s("sectionManagement.filterByVisibility")})}),e.jsxs(R,{children:[e.jsx(b,{value:"all",children:"All"}),e.jsx(b,{value:"visible",children:"Visible"}),e.jsx(b,{value:"hidden",children:"Hidden"})]})]})]})})}),r.length===0?e.jsx(I,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No sections yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Create your first section to start building your panchayat website"}),e.jsxs(m,{onClick:F,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Create First Section"]})]})}):u.length===0?e.jsx(I,{children:e.jsxs(V,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:s("sectionManagement.noSections")}),e.jsx(m,{variant:"outline",className:"mt-4",onClick:()=>{w(""),D("all"),k("all")},children:s("sectionManagement.all",{defaultValue:"Clear Filters"})})]})}):e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 text-xs sm:text-sm text-muted-foreground",children:[e.jsxs("span",{children:[u.length," of ",r.length," section",u.length!==1?"s":""]}),e.jsx("span",{className:"hidden sm:inline",children:"Drag sections to reorder"}),e.jsx("span",{className:"sm:hidden",children:"Drag to reorder"})]}),u.map(a=>{const t=r.findIndex(l=>l.id===a.id);return e.jsx(ge,{section:a,index:t,onEdit:z,onDelete:H,onToggleVisibility:Q,onDuplicate:W,onDragStart:$,onDragOver:K,onDrop:Y,isDragging:y===t},a.id)})]}),e.jsx(X,{open:N,onOpenChange:d,children:e.jsxs(Z,{className:"max-w-[95vw] sm:max-w-7xl lg:max-w-[90vw] max-h-[95vh] overflow-y-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs(ee,{children:[e.jsx(te,{children:g?"Edit Section":"Create New Section"}),e.jsx(se,{children:"Configure the section content, layout, and styling. Use the tabs to organize different aspects of your section."})]}),e.jsx(le,{section:g,isPlatform:!1,onSave:G,onCancel:()=>{d(!1),x(null)},isOpen:N})]})})]})}export{Ge as PanchayatWebsiteManager};
