import{r as a,H as M,t as l,ah as h,j as e,C as b,d as C,e as A,f as E,b as F,B as p,X as j,x as D}from"./index-B5GP4ZU0.js";import{B as u}from"./badge-ALW9Fyqs.js";import{T as U,a as H,b as f,c as v}from"./tabs-C4k9DC07.js";import{f as N}from"./format-MGXwiYcE.js";import{M as $}from"./message-square-JhQa2v7O.js";import{C as q}from"./clock-C1_AbEPp.js";import{C as S}from"./check-BfJ-MShT.js";function V({panchayatId:i}){const[T,P]=a.useState([]),[t,g]=a.useState(null),[c,k]=a.useState([]),[B,y]=a.useState(!0),[I,z]=a.useState("pending");a.useEffect(()=>{n()},[i]),a.useEffect(()=>{t&&d(t)},[t]);const n=async()=>{y(!0);try{const s=await M.list({pageSize:50});P(s.items),s.items.length>0&&!t&&g(s.items[0].id)}catch{l.error("Failed to load posts")}finally{y(!1)}},d=async s=>{try{const r=await h.list(s,{pageSize:100});k(r.items)}catch{l.error("Failed to load comments")}},R=async(s,r)=>{try{await h.approve(s,r),l.success("Comment approved"),d(s),n()}catch{l.error("Failed to approve comment")}},w=async(s,r)=>{if(confirm("Are you sure you want to delete this comment?"))try{await h.delete(s,r),l.success("Comment deleted"),d(s),n()}catch{l.error("Failed to delete comment")}},o=c.filter(s=>s.status==="pending"),m=c.filter(s=>s.status==="approved"),x=c.filter(s=>s.status==="rejected");return B?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#FF9933] mx-auto"}),e.jsx("p",{className:"mt-4 text-[#666]",children:"Loading comments..."})]})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-[#1B2B5E]",children:"Comments Management"}),e.jsx("p",{className:"text-sm sm:text-base text-[#666] mt-1",children:"Review and moderate comments on posts"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs(b,{className:"lg:col-span-1",children:[e.jsxs(C,{children:[e.jsx(A,{children:"Posts"}),e.jsx(E,{children:"Select a post to view comments"})]}),e.jsx(F,{children:e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:T.map(s=>e.jsxs("button",{onClick:()=>g(s.id),className:`w-full text-left p-3 rounded-lg border transition-colors ${t===s.id?"border-[#FF9933] bg-[#FF9933]/10":"border-[#E5E5E5] hover:border-[#E31E24]"}`,children:[e.jsxs("p",{className:"font-medium text-sm line-clamp-2",children:[s.content.substring(0,100),"..."]}),e.jsx("div",{className:"flex items-center gap-4 mt-2 text-xs text-[#666]",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3"}),s.comments]})})]},s.id))})})]}),e.jsxs(b,{className:"lg:col-span-2",children:[e.jsxs(C,{children:[e.jsx(A,{children:"Comments"}),e.jsx(E,{children:t?`Comments for selected post (${c.length} total)`:"Select a post to view comments"})]}),e.jsx(F,{children:t?e.jsxs(U,{value:I,onValueChange:z,children:[e.jsxs(H,{children:[e.jsxs(f,{value:"pending",children:["Pending (",o.length,")"]}),e.jsxs(f,{value:"approved",children:["Approved (",m.length,")"]}),e.jsxs(f,{value:"rejected",children:["Rejected (",x.length,")"]})]}),e.jsx(v,{value:"pending",className:"space-y-4 mt-4",children:o.length===0?e.jsx("div",{className:"text-center py-8 text-[#666]",children:"No pending comments"}):o.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[#FF9933] flex items-center justify-center text-white font-semibold",children:s.author.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.author}),s.authorEmail&&e.jsx("p",{className:"text-sm text-[#666]",children:s.authorEmail})]})]}),e.jsxs(u,{variant:"outline",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Pending"]})]}),e.jsx("p",{className:"text-[#1a1a1a]",children:s.content}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 text-sm text-[#666]",children:[e.jsx("span",{children:N(s.createdAt)}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(p,{size:"sm",variant:"outline",className:"flex-1 sm:flex-none",onClick:()=>R(s.postId,s.id),children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(p,{size:"sm",variant:"outline",className:"text-red-600 flex-1 sm:flex-none",onClick:()=>w(s.postId,s.id),children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})]},s.id))}),e.jsx(v,{value:"approved",className:"space-y-4 mt-4",children:m.length===0?e.jsx("div",{className:"text-center py-8 text-[#666]",children:"No approved comments"}):m.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[#138808] flex items-center justify-center text-white font-semibold",children:s.author.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.author}),s.authorEmail&&e.jsx("p",{className:"text-sm text-[#666]",children:s.authorEmail})]})]}),e.jsxs(u,{variant:"default",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Approved"]})]}),e.jsx("p",{className:"text-[#1a1a1a]",children:s.content}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 text-sm text-[#666]",children:[e.jsx("span",{children:N(s.createdAt)}),e.jsxs(p,{size:"sm",variant:"outline",className:"text-red-600 w-full sm:w-auto",onClick:()=>w(s.postId,s.id),children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"Delete"]})]})]},s.id))}),e.jsx(v,{value:"rejected",className:"space-y-4 mt-4",children:x.length===0?e.jsx("div",{className:"text-center py-8 text-[#666]",children:"No rejected comments"}):x.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3 opacity-60",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[#666] flex items-center justify-center text-white font-semibold",children:s.author.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.author}),s.authorEmail&&e.jsx("p",{className:"text-sm text-[#666]",children:s.authorEmail})]})]}),e.jsxs(u,{variant:"secondary",children:[e.jsx(j,{className:"h-3 w-3 mr-1"}),"Rejected"]})]}),e.jsx("p",{className:"text-[#1a1a1a]",children:s.content}),e.jsx("div",{className:"text-sm text-[#666]",children:N(s.createdAt)})]},s.id))})]}):e.jsx("div",{className:"text-center py-12 text-[#666]",children:"Select a post from the left to view comments"})})]})]})]})}function Y(){const{user:i}=D();return i?.panchayatId?e.jsx(V,{panchayatId:i.panchayatId}):e.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Loading..."})}export{Y as CommentsPage};
