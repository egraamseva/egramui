import{P as ye,a as le,k as Ee,S as z,b as He,T as k,F as T,c as L,D as Y,d as G,N as ke,e as Le,f as K,E as We,g as $e,h as De,m as X,i as _e}from"./NewsletterPage-D8at8f-q.js";import"./index-B5GP4ZU0.js";import"./input-C4RtHFee.js";import"./label-k4a1c30R.js";import"./dialog-D8fBtqfZ.js";import"./with-selector-CUNPgmmD.js";import"./separator-D-SV_8Ad.js";import"./list-CUSQgfHx.js";import"./image-hr9zOed5.js";import"./table-BDHQV-gI.js";import"./badge-ALW9Fyqs.js";import"./tabs-C4k9DC07.js";import"./ImageWithFallback-CPTj3iC7.js";import"./image-modal-c-Ha-HLI.js";import"./circle-plus-B8nn-p_t.js";import"./trash-2-Dvt3QX8d.js";import"./file-text-DFT2MlA2.js";import"./upload-wi-AKsz6.js";import"./plus-BdOJHdON.js";var Q,Z;if(typeof WeakMap<"u"){let t=new WeakMap;Q=e=>t.get(e),Z=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;Q=o=>{for(let l=0;l<t.length;l+=2)if(t[l]==o)return t[l+1]},Z=(o,l)=>(n==10&&(n=0),t[n++]=o,t[n++]=l)}var C=class{constructor(t,e,n,o){this.width=t,this.height=e,this.map=n,this.problems=o}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const o=e%this.width,l=e/this.width|0;let r=o+1,s=l+1;for(let i=1;r<this.width&&this.map[e+i]==n;i++)r++;for(let i=1;s<this.height&&this.map[e+this.width*i]==n;i++)s++;return{left:o,top:l,right:r,bottom:s}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:o,right:l,top:r,bottom:s}=this.findCell(t);return e=="horiz"?(n<0?o==0:l==this.width)?null:this.map[r*this.width+(n<0?o-1:l)]:(n<0?r==0:s==this.height)?null:this.map[o+this.width*(n<0?r-1:s)]}rectBetween(t,e){const{left:n,right:o,top:l,bottom:r}=this.findCell(t),{left:s,right:i,top:a,bottom:c}=this.findCell(e);return{left:Math.min(n,s),top:Math.min(l,a),right:Math.max(o,i),bottom:Math.max(r,c)}}cellsInRect(t){const e=[],n={};for(let o=t.top;o<t.bottom;o++)for(let l=t.left;l<t.right;l++){const r=o*this.width+l,s=this.map[r];n[s]||(n[s]=!0,!(l==t.left&&l&&this.map[r-1]==s||o==t.top&&o&&this.map[r-this.width]==s)&&e.push(s))}return e}positionAt(t,e,n){for(let o=0,l=0;;o++){const r=l+n.child(o).nodeSize;if(o==t){let s=e+t*this.width;const i=(t+1)*this.width;for(;s<i&&this.map[s]<l;)s++;return s==i?r-1:this.map[s]}l=r}}static get(t){return Q(t)||Z(t,Be(t))}};function Be(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=Pe(t),n=t.childCount,o=[];let l=0,r=null;const s=[];for(let c=0,d=e*n;c<d;c++)o[c]=0;for(let c=0,d=0;c<n;c++){const f=t.child(c);d++;for(let p=0;;p++){for(;l<o.length&&o[l]!=0;)l++;if(p==f.childCount)break;const g=f.child(p),{colspan:m,rowspan:w,colwidth:S}=g.attrs;for(let R=0;R<w;R++){if(R+c>=n){(r||(r=[])).push({type:"overlong_rowspan",pos:d,n:w-R});break}const E=l+R*e;for(let x=0;x<m;x++){o[E+x]==0?o[E+x]=d:(r||(r=[])).push({type:"collision",row:c,pos:d,n:m-x});const B=S&&S[x];if(B){const D=(E+x)%e*2,U=s[D];U==null||U!=B&&s[D+1]==1?(s[D]=B,s[D+1]=1):U==B&&s[D+1]++}}}l+=m,d+=g.nodeSize}const u=(c+1)*e;let h=0;for(;l<u;)o[l++]==0&&h++;h&&(r||(r=[])).push({type:"missing",row:c,n:h}),d++}(e===0||n===0)&&(r||(r=[])).push({type:"zero_sized"});const i=new C(e,n,o,r);let a=!1;for(let c=0;!a&&c<s.length;c+=2)s[c]!=null&&s[c+1]<n&&(a=!0);return a&&Ie(i,s,t),i}function Pe(t){let e=-1,n=!1;for(let o=0;o<t.childCount;o++){const l=t.child(o);let r=0;if(n)for(let s=0;s<o;s++){const i=t.child(s);for(let a=0;a<i.childCount;a++){const c=i.child(a);s+c.attrs.rowspan>o&&(r+=c.attrs.colspan)}}for(let s=0;s<l.childCount;s++){const i=l.child(s);r+=i.attrs.colspan,i.attrs.rowspan>1&&(n=!0)}e==-1?e=r:e!=r&&(e=Math.max(e,r))}return e}function Ie(t,e,n){t.problems||(t.problems=[]);const o={};for(let l=0;l<t.map.length;l++){const r=t.map[l];if(o[r])continue;o[r]=!0;const s=n.nodeAt(r);if(!s)throw new RangeError(`No cell with offset ${r} found`);let i=null;const a=s.attrs;for(let c=0;c<a.colspan;c++){const d=(l+c)%t.width,f=e[d*2];f!=null&&(!a.colwidth||a.colwidth[c]!=f)&&((i||(i=Oe(a)))[c]=f)}i&&t.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:i})}}function Oe(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function y(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const o=t.nodes[n],l=o.spec.tableRole;l&&(e[l]=o)}}return e}var H=new le("selectingCells");function $(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function Fe(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function M(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function q(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=$(e.$head)||je(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function je(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const o=e.type.spec.tableRole;if(o=="cell"||o=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function ee(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function Ve(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function re(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Se(t,e,n){const o=t.node(-1),l=C.get(o),r=t.start(-1),s=l.nextCell(t.pos-r,e,n);return s==null?null:t.node(0).resolve(r+s)}function W(t,e,n=1){const o={...t,colspan:t.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(e,n),o.colwidth.some(l=>l>0)||(o.colwidth=null)),o}function Ae(t,e,n=1){const o={...t,colspan:t.colspan+n};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let l=0;l<n;l++)o.colwidth.splice(e,0,0)}return o}function Ke(t,e,n){const o=y(e.type.schema).header_cell;for(let l=0;l<t.height;l++)if(e.nodeAt(t.map[n+l*t.width]).type!=o)return!1;return!0}var b=class N extends z{constructor(e,n=e){const o=e.node(-1),l=C.get(o),r=e.start(-1),s=l.rectBetween(e.pos-r,n.pos-r),i=e.node(0),a=l.cellsInRect(s).filter(d=>d!=n.pos-r);a.unshift(n.pos-r);const c=a.map(d=>{const f=o.nodeAt(d);if(!f)throw RangeError(`No cell with offset ${d} found`);const u=r+d+1;return new He(i.resolve(u),i.resolve(u+f.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){const o=e.resolve(n.map(this.$anchorCell.pos)),l=e.resolve(n.map(this.$headCell.pos));if(ee(o)&&ee(l)&&re(o,l)){const r=this.$anchorCell.node(-1)!=o.node(-1);return r&&this.isRowSelection()?N.rowSelection(o,l):r&&this.isColSelection()?N.colSelection(o,l):new N(o,l)}return k.between(o,l)}content(){const e=this.$anchorCell.node(-1),n=C.get(e),o=this.$anchorCell.start(-1),l=n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),r={},s=[];for(let a=l.top;a<l.bottom;a++){const c=[];for(let d=a*n.width+l.left,f=l.left;f<l.right;f++,d++){const u=n.map[d];if(r[u])continue;r[u]=!0;const h=n.findCell(u);let p=e.nodeAt(u);if(!p)throw RangeError(`No cell with offset ${u} found`);const g=l.left-h.left,m=h.right-l.right;if(g>0||m>0){let w=p.attrs;if(g>0&&(w=W(w,0,g)),m>0&&(w=W(w,w.colspan-m,m)),h.left<l.left){if(p=p.type.createAndFill(w),!p)throw RangeError(`Could not create cell with attrs ${JSON.stringify(w)}`)}else p=p.type.create(w,p.content)}if(h.top<l.top||h.bottom>l.bottom){const w={...p.attrs,rowspan:Math.min(h.bottom,l.bottom)-Math.max(h.top,l.top)};h.top<l.top?p=p.type.createAndFill(w):p=p.type.create(w,p.content)}c.push(p)}s.push(e.child(a).copy(T.from(c)))}const i=this.isColSelection()&&this.isRowSelection()?e:s;return new L(T.from(i),1,1)}replace(e,n=L.empty){const o=e.steps.length,l=this.ranges;for(let s=0;s<l.length;s++){const{$from:i,$to:a}=l[s],c=e.mapping.slice(o);e.replace(c.map(i.pos),c.map(a.pos),s?L.empty:n)}const r=z.findFrom(e.doc.resolve(e.mapping.slice(o).map(this.to)),-1);r&&e.setSelection(r)}replaceWith(e,n){this.replace(e,new L(T.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),o=C.get(n),l=this.$anchorCell.start(-1),r=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-l,this.$headCell.pos-l));for(let s=0;s<r.length;s++)e(n.nodeAt(r[s]),l+r[s])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const o=e+this.$anchorCell.nodeAfter.attrs.rowspan,l=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,l)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const o=e.node(-1),l=C.get(o),r=e.start(-1),s=l.findCell(e.pos-r),i=l.findCell(n.pos-r),a=e.node(0);return s.top<=i.top?(s.top>0&&(e=a.resolve(r+l.map[s.left])),i.bottom<l.height&&(n=a.resolve(r+l.map[l.width*(l.height-1)+i.right-1]))):(i.top>0&&(n=a.resolve(r+l.map[i.left])),s.bottom<l.height&&(e=a.resolve(r+l.map[l.width*(l.height-1)+s.right-1]))),new N(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=C.get(e),o=this.$anchorCell.start(-1),l=n.colCount(this.$anchorCell.pos-o),r=n.colCount(this.$headCell.pos-o);if(Math.min(l,r)>0)return!1;const s=l+this.$anchorCell.nodeAfter.attrs.colspan,i=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,i)==n.width}eq(e){return e instanceof N&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const o=e.node(-1),l=C.get(o),r=e.start(-1),s=l.findCell(e.pos-r),i=l.findCell(n.pos-r),a=e.node(0);return s.left<=i.left?(s.left>0&&(e=a.resolve(r+l.map[s.top*l.width])),i.right<l.width&&(n=a.resolve(r+l.map[l.width*(i.top+1)-1]))):(i.left>0&&(n=a.resolve(r+l.map[i.top*l.width])),s.right<l.width&&(e=a.resolve(r+l.map[l.width*(s.top+1)-1]))),new N(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new N(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,o=n){return new N(e.resolve(n),e.resolve(o))}getBookmark(){return new Xe(this.$anchorCell.pos,this.$headCell.pos)}};b.prototype.visible=!1;z.jsonID("cell",b);var Xe=class Re{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Re(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),o=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&o.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&o.index()<o.parent.childCount&&re(n,o)?new b(n,o):z.near(o,1)}};function qe(t){if(!(t.selection instanceof b))return null;const e=[];return t.selection.forEachCell((n,o)=>{e.push(G.node(o,o+n.nodeSize,{class:"selectedCell"}))}),Y.create(t.doc,e)}function Ue({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,o=e.pos,l=t.depth;for(;l>=0&&!(t.after(l+1)<t.end(l));l--,n++);for(let r=e.depth;r>=0&&!(e.before(r+1)>e.start(r));r--,o--);return n==o&&/row|table/.test(t.node(l).type.spec.tableRole)}function Je({$from:t,$to:e}){let n,o;for(let l=t.depth;l>0;l--){const r=t.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){n=r;break}}for(let l=e.depth;l>0;l--){const r=e.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){o=r;break}}return n!==o&&e.parentOffset===0}function Ye(t,e,n){const o=(e||t).selection,l=(e||t).doc;let r,s;if(o instanceof ke&&(s=o.node.type.spec.tableRole)){if(s=="cell"||s=="header_cell")r=b.create(l,o.from);else if(s=="row"){const i=l.resolve(o.from+1);r=b.rowSelection(i,i)}else if(!n){const i=C.get(o.node),a=o.from+1,c=a+i.map[i.width*i.height-1];r=b.create(l,a+1,c)}}else o instanceof k&&Ue(o)?r=k.create(l,o.from):o instanceof k&&Je(o)&&(r=k.create(l,o.$from.start(),o.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}var Ge=new le("fix-tables");function xe(t,e,n,o){const l=t.childCount,r=e.childCount;e:for(let s=0,i=0;s<r;s++){const a=e.child(s);for(let c=i,d=Math.min(l,s+3);c<d;c++)if(t.child(c)==a){i=c+1,n+=a.nodeSize;continue e}o(a,n),i<l&&t.child(i).sameMarkup(a)?xe(t.child(i),a,n+1,o):a.nodesBetween(0,a.content.size,o,n+1),n+=a.nodeSize}}function Me(t,e){let n;const o=(l,r)=>{l.type.spec.tableRole=="table"&&(n=Qe(t,l,r,n))};return e?e.doc!=t.doc&&xe(e.doc,t.doc,0,o):t.doc.descendants(o),n}function Qe(t,e,n,o){const l=C.get(e);if(!l.problems)return o;o||(o=t.tr);const r=[];for(let a=0;a<l.height;a++)r.push(0);for(let a=0;a<l.problems.length;a++){const c=l.problems[a];if(c.type=="collision"){const d=e.nodeAt(c.pos);if(!d)continue;const f=d.attrs;for(let u=0;u<f.rowspan;u++)r[c.row+u]+=c.n;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,W(f,f.colspan-c.n,c.n))}else if(c.type=="missing")r[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const d=e.nodeAt(c.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...d.attrs,rowspan:d.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const d=e.nodeAt(c.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...d.attrs,colwidth:c.colwidth})}else if(c.type=="zero_sized"){const d=o.mapping.map(n);o.delete(d,d+e.nodeSize)}}let s,i;for(let a=0;a<r.length;a++)r[a]&&(s==null&&(s=a),i=a);for(let a=0,c=n+1;a<l.height;a++){const d=e.child(a),f=c+d.nodeSize,u=r[a];if(u>0){let h="cell";d.firstChild&&(h=d.firstChild.type.spec.tableRole);const p=[];for(let m=0;m<u;m++){const w=y(t.schema)[h].createAndFill();w&&p.push(w)}const g=(a==0||s==a-1)&&i==a?c+1:f-1;o.insert(o.mapping.map(g),p)}c=f}return o.setMeta(Ge,{fixTables:!0})}function v(t){const e=t.selection,n=q(t),o=n.node(-1),l=n.start(-1),r=C.get(o);return{...e instanceof b?r.rectBetween(e.$anchorCell.pos-l,e.$headCell.pos-l):r.findCell(n.pos-l),tableStart:l,map:r,table:o}}function Te(t,{map:e,tableStart:n,table:o},l){let r=l>0?-1:0;Ke(e,o,l+r)&&(r=l==0||l==e.width?null:0);for(let s=0;s<e.height;s++){const i=s*e.width+l;if(l>0&&l<e.width&&e.map[i-1]==e.map[i]){const a=e.map[i],c=o.nodeAt(a);t.setNodeMarkup(t.mapping.map(n+a),null,Ae(c.attrs,l-e.colCount(a))),s+=c.attrs.rowspan-1}else{const a=r==null?y(o.type.schema).cell:o.nodeAt(e.map[i+r]).type,c=e.positionAt(s,l,o);t.insert(t.mapping.map(n+c),a.createAndFill())}}return t}function Ze(t,e){if(!M(t))return!1;if(e){const n=v(t);e(Te(t.tr,n,n.left))}return!0}function et(t,e){if(!M(t))return!1;if(e){const n=v(t);e(Te(t.tr,n,n.right))}return!0}function tt(t,{map:e,table:n,tableStart:o},l){const r=t.mapping.maps.length;for(let s=0;s<e.height;){const i=s*e.width+l,a=e.map[i],c=n.nodeAt(a),d=c.attrs;if(l>0&&e.map[i-1]==a||l<e.width-1&&e.map[i+1]==a)t.setNodeMarkup(t.mapping.slice(r).map(o+a),null,W(d,l-e.colCount(a)));else{const f=t.mapping.slice(r).map(o+a);t.delete(f,f+c.nodeSize)}s+=d.rowspan}}function nt(t,e){if(!M(t))return!1;if(e){const n=v(t),o=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let l=n.right-1;tt(o,n,l),l!=n.left;l--){const r=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!r)throw RangeError("No table found");n.table=r,n.map=C.get(r)}e(o)}return!0}function ot(t,e,n){var o;const l=y(e.type.schema).header_cell;for(let r=0;r<t.width;r++)if(((o=e.nodeAt(t.map[r+n*t.width]))==null?void 0:o.type)!=l)return!1;return!0}function ve(t,{map:e,tableStart:n,table:o},l){var r;let s=n;for(let c=0;c<l;c++)s+=o.child(c).nodeSize;const i=[];let a=l>0?-1:0;ot(e,o,l+a)&&(a=l==0||l==e.height?null:0);for(let c=0,d=e.width*l;c<e.width;c++,d++)if(l>0&&l<e.height&&e.map[d]==e.map[d-e.width]){const f=e.map[d],u=o.nodeAt(f).attrs;t.setNodeMarkup(n+f,null,{...u,rowspan:u.rowspan+1}),c+=u.colspan-1}else{const f=a==null?y(o.type.schema).cell:(r=o.nodeAt(e.map[d+a*e.width]))==null?void 0:r.type,u=f?.createAndFill();u&&i.push(u)}return t.insert(s,y(o.type.schema).row.create(null,i)),t}function lt(t,e){if(!M(t))return!1;if(e){const n=v(t);e(ve(t.tr,n,n.top))}return!0}function rt(t,e){if(!M(t))return!1;if(e){const n=v(t);e(ve(t.tr,n,n.bottom))}return!0}function st(t,{map:e,table:n,tableStart:o},l){let r=0;for(let c=0;c<l;c++)r+=n.child(c).nodeSize;const s=r+n.child(l).nodeSize,i=t.mapping.maps.length;t.delete(r+o,s+o);const a=new Set;for(let c=0,d=l*e.width;c<e.width;c++,d++){const f=e.map[d];if(!a.has(f)){if(a.add(f),l>0&&f==e.map[d-e.width]){const u=n.nodeAt(f).attrs;t.setNodeMarkup(t.mapping.slice(i).map(f+o),null,{...u,rowspan:u.rowspan-1}),c+=u.colspan-1}else if(l<e.height&&f==e.map[d+e.width]){const u=n.nodeAt(f),h=u.attrs,p=u.type.create({...h,rowspan:u.attrs.rowspan-1},u.content),g=e.positionAt(l+1,c,n);t.insert(t.mapping.slice(i).map(o+g),p),c+=h.colspan-1}}}}function it(t,e){if(!M(t))return!1;if(e){const n=v(t),o=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let l=n.bottom-1;st(o,n,l),l!=n.top;l--){const r=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!r)throw RangeError("No table found");n.table=r,n.map=C.get(n.table)}e(o)}return!0}function se(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function ct({width:t,height:e,map:n},o){let l=o.top*t+o.left,r=l,s=(o.bottom-1)*t+o.left,i=l+(o.right-o.left-1);for(let a=o.top;a<o.bottom;a++){if(o.left>0&&n[r]==n[r-1]||o.right<t&&n[i]==n[i+1])return!0;r+=t,i+=t}for(let a=o.left;a<o.right;a++){if(o.top>0&&n[l]==n[l-t]||o.bottom<e&&n[s]==n[s+t])return!0;l++,s++}return!1}function ie(t,e){const n=t.selection;if(!(n instanceof b)||n.$anchorCell.pos==n.$headCell.pos)return!1;const o=v(t),{map:l}=o;if(ct(l,o))return!1;if(e){const r=t.tr,s={};let i=T.empty,a,c;for(let d=o.top;d<o.bottom;d++)for(let f=o.left;f<o.right;f++){const u=l.map[d*l.width+f],h=o.table.nodeAt(u);if(!(s[u]||!h))if(s[u]=!0,a==null)a=u,c=h;else{se(h)||(i=i.append(h.content));const p=r.mapping.map(u+o.tableStart);r.delete(p,p+h.nodeSize)}}if(a==null||c==null)return!0;if(r.setNodeMarkup(a+o.tableStart,null,{...Ae(c.attrs,c.attrs.colspan,o.right-o.left-c.attrs.colspan),rowspan:o.bottom-o.top}),i.size){const d=a+1+c.content.size,f=se(c)?a+1:d;r.replaceWith(f+o.tableStart,d+o.tableStart,i)}r.setSelection(new b(r.doc.resolve(a+o.tableStart))),e(r)}return!0}function ce(t,e){const n=y(t.schema);return at(({node:o})=>n[o.type.spec.tableRole])(t,e)}function at(t){return(e,n)=>{var o;const l=e.selection;let r,s;if(l instanceof b){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,s=l.$anchorCell.pos}else{if(r=Fe(l.$from),!r)return!1;s=(o=$(l.$from))==null?void 0:o.pos}if(r==null||s==null||r.attrs.colspan==1&&r.attrs.rowspan==1)return!1;if(n){let i=r.attrs;const a=[],c=i.colwidth;i.rowspan>1&&(i={...i,rowspan:1}),i.colspan>1&&(i={...i,colspan:1});const d=v(e),f=e.tr;for(let h=0;h<d.right-d.left;h++)a.push(c?{...i,colwidth:c&&c[h]?[c[h]]:null}:i);let u;for(let h=d.top;h<d.bottom;h++){let p=d.map.positionAt(h,d.left,d.table);h==d.top&&(p+=r.nodeSize);for(let g=d.left,m=0;g<d.right;g++,m++)g==d.left&&h==d.top||f.insert(u=f.mapping.map(p+d.tableStart,1),t({node:r,row:h,col:g}).createAndFill(a[m]))}f.setNodeMarkup(s,t({node:r,row:d.top,col:d.left}),a[0]),l instanceof b&&f.setSelection(new b(f.doc.resolve(l.$anchorCell.pos),u?f.doc.resolve(u):void 0)),n(f)}return!0}}function dt(t,e){return function(n,o){if(!M(n))return!1;const l=q(n);if(l.nodeAfter.attrs[t]===e)return!1;if(o){const r=n.tr;n.selection instanceof b?n.selection.forEachCell((s,i)=>{s.attrs[t]!==e&&r.setNodeMarkup(i,null,{...s.attrs,[t]:e})}):r.setNodeMarkup(l.pos,null,{...l.nodeAfter.attrs,[t]:e}),o(r)}return!0}}function ft(t){return function(e,n){if(!M(e))return!1;if(n){const o=y(e.schema),l=v(e),r=e.tr,s=l.map.cellsInRect(t=="column"?{left:l.left,top:0,right:l.right,bottom:l.map.height}:t=="row"?{left:0,top:l.top,right:l.map.width,bottom:l.bottom}:l),i=s.map(a=>l.table.nodeAt(a));for(let a=0;a<s.length;a++)i[a].type==o.header_cell&&r.setNodeMarkup(l.tableStart+s[a],o.cell,i[a].attrs);if(r.steps.length==0)for(let a=0;a<s.length;a++)r.setNodeMarkup(l.tableStart+s[a],o.header_cell,i[a].attrs);n(r)}return!0}}function ae(t,e,n){const o=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let l=0;l<o.length;l++){const r=e.table.nodeAt(o[l]);if(r&&r.type!==n.header_cell)return!1}return!0}function _(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?ft(t):function(n,o){if(!M(n))return!1;if(o){const l=y(n.schema),r=v(n),s=n.tr,i=ae("row",r,l),a=ae("column",r,l),d=(t==="column"?i:t==="row"?a:!1)?1:0,f=t=="column"?{left:0,top:d,right:1,bottom:r.map.height}:t=="row"?{left:d,top:0,right:r.map.width,bottom:1}:r,u=t=="column"?a?l.cell:l.header_cell:t=="row"?i?l.cell:l.header_cell:l.cell;r.map.cellsInRect(f).forEach(h=>{const p=h+r.tableStart,g=s.doc.nodeAt(p);g&&s.setNodeMarkup(p,u,g.attrs)}),o(s)}return!0}}_("row",{useDeprecatedLogic:!0});_("column",{useDeprecatedLogic:!0});var ut=_("cell",{useDeprecatedLogic:!0});function pt(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let o=t.index(-1)-1,l=t.before();o>=0;o--){const r=t.node(-1).child(o),s=r.lastChild;if(s)return l-1-s.nodeSize;l-=r.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let o=t.indexAfter(-1),l=t.after();o<n.childCount;o++){const r=n.child(o);if(r.childCount)return l+1;l+=r.nodeSize}}return null}function de(t){return function(e,n){if(!M(e))return!1;const o=pt(q(e),t);if(o==null)return!1;if(n){const l=e.doc.resolve(o);n(e.tr.setSelection(k.between(l,Ve(l))).scrollIntoView())}return!0}}function ht(t,e){const n=t.selection.$anchor;for(let o=n.depth;o>0;o--)if(n.node(o).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(o),n.after(o)).scrollIntoView()),!0;return!1}function P(t,e){const n=t.selection;if(!(n instanceof b))return!1;if(e){const o=t.tr,l=y(t.schema).cell.createAndFill().content;n.forEachCell((r,s)=>{r.content.eq(l)||o.replace(o.mapping.map(s+1),o.mapping.map(s+r.nodeSize-1),new L(l,0,0))}),o.docChanged&&e(o)}return!0}function mt(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:o}=t;for(;e.childCount==1&&(n>0&&o>0||e.child(0).type.spec.tableRole=="table");)n--,o--,e=e.child(0).content;const l=e.child(0),r=l.type.spec.tableRole,s=l.type.schema,i=[];if(r=="row")for(let a=0;a<e.childCount;a++){let c=e.child(a).content;const d=a?0:Math.max(0,n-1),f=a<e.childCount-1?0:Math.max(0,o-1);(d||f)&&(c=te(y(s).row,new L(c,d,f)).content),i.push(c)}else if(r=="cell"||r=="header_cell")i.push(n||o?te(y(s).row,new L(e,n,o)).content:e);else return null;return gt(s,i)}function gt(t,e){const n=[];for(let l=0;l<e.length;l++){const r=e[l];for(let s=r.childCount-1;s>=0;s--){const{rowspan:i,colspan:a}=r.child(s).attrs;for(let c=l;c<l+i;c++)n[c]=(n[c]||0)+a}}let o=0;for(let l=0;l<n.length;l++)o=Math.max(o,n[l]);for(let l=0;l<n.length;l++)if(l>=e.length&&e.push(T.empty),n[l]<o){const r=y(t).cell.createAndFill(),s=[];for(let i=n[l];i<o;i++)s.push(r);e[l]=e[l].append(T.from(s))}return{height:e.length,width:o,rows:e}}function te(t,e){const n=t.createAndFill();return new Le(n).replace(0,n.content.size,e).doc}function wt({width:t,height:e,rows:n},o,l){if(t!=o){const r=[],s=[];for(let i=0;i<n.length;i++){const a=n[i],c=[];for(let d=r[i]||0,f=0;d<o;f++){let u=a.child(f%a.childCount);d+u.attrs.colspan>o&&(u=u.type.createChecked(W(u.attrs,u.attrs.colspan,d+u.attrs.colspan-o),u.content)),c.push(u),d+=u.attrs.colspan;for(let h=1;h<u.attrs.rowspan;h++)r[i+h]=(r[i+h]||0)+u.attrs.colspan}s.push(T.from(c))}n=s,t=o}if(e!=l){const r=[];for(let s=0,i=0;s<l;s++,i++){const a=[],c=n[i%e];for(let d=0;d<c.childCount;d++){let f=c.child(d);s+f.attrs.rowspan>l&&(f=f.type.create({...f.attrs,rowspan:Math.max(1,l-f.attrs.rowspan)},f.content)),a.push(f)}r.push(T.from(a))}n=r,e=l}return{width:t,height:e,rows:n}}function bt(t,e,n,o,l,r,s){const i=t.doc.type.schema,a=y(i);let c,d;if(l>e.width)for(let f=0,u=0;f<e.height;f++){const h=n.child(f);u+=h.nodeSize;const p=[];let g;h.lastChild==null||h.lastChild.type==a.cell?g=c||(c=a.cell.createAndFill()):g=d||(d=a.header_cell.createAndFill());for(let m=e.width;m<l;m++)p.push(g);t.insert(t.mapping.slice(s).map(u-1+o),p)}if(r>e.height){const f=[];for(let p=0,g=(e.height-1)*e.width;p<Math.max(e.width,l);p++){const m=p>=e.width?!1:n.nodeAt(e.map[g+p]).type==a.header_cell;f.push(m?d||(d=a.header_cell.createAndFill()):c||(c=a.cell.createAndFill()))}const u=a.row.create(null,T.from(f)),h=[];for(let p=e.height;p<r;p++)h.push(u);t.insert(t.mapping.slice(s).map(o+n.nodeSize-2),h)}return!!(c||d)}function fe(t,e,n,o,l,r,s,i){if(s==0||s==e.height)return!1;let a=!1;for(let c=l;c<r;c++){const d=s*e.width+c,f=e.map[d];if(e.map[d-e.width]==f){a=!0;const u=n.nodeAt(f),{top:h,left:p}=e.findCell(f);t.setNodeMarkup(t.mapping.slice(i).map(f+o),null,{...u.attrs,rowspan:s-h}),t.insert(t.mapping.slice(i).map(e.positionAt(s,p,n)),u.type.createAndFill({...u.attrs,rowspan:h+u.attrs.rowspan-s})),c+=u.attrs.colspan-1}}return a}function ue(t,e,n,o,l,r,s,i){if(s==0||s==e.width)return!1;let a=!1;for(let c=l;c<r;c++){const d=c*e.width+s,f=e.map[d];if(e.map[d-1]==f){a=!0;const u=n.nodeAt(f),h=e.colCount(f),p=t.mapping.slice(i).map(f+o);t.setNodeMarkup(p,null,W(u.attrs,s-h,u.attrs.colspan-(s-h))),t.insert(p+u.nodeSize,u.type.createAndFill(W(u.attrs,0,s-h))),c+=u.attrs.rowspan-1}}return a}function pe(t,e,n,o,l){let r=n?t.doc.nodeAt(n-1):t.doc;if(!r)throw new Error("No table found");let s=C.get(r);const{top:i,left:a}=o,c=a+l.width,d=i+l.height,f=t.tr;let u=0;function h(){if(r=n?f.doc.nodeAt(n-1):f.doc,!r)throw new Error("No table found");s=C.get(r),u=f.mapping.maps.length}bt(f,s,r,n,c,d,u)&&h(),fe(f,s,r,n,a,c,i,u)&&h(),fe(f,s,r,n,a,c,d,u)&&h(),ue(f,s,r,n,i,d,a,u)&&h(),ue(f,s,r,n,i,d,c,u)&&h();for(let p=i;p<d;p++){const g=s.positionAt(p,a,r),m=s.positionAt(p,c,r);f.replace(f.mapping.slice(u).map(g+n),f.mapping.slice(u).map(m+n),new L(l.rows[p-i],0,0))}h(),f.setSelection(new b(f.doc.resolve(n+s.positionAt(i,a,r)),f.doc.resolve(n+s.positionAt(d-1,c-1,r)))),e(f)}var Ct=Ee({ArrowLeft:I("horiz",-1),ArrowRight:I("horiz",1),ArrowUp:I("vert",-1),ArrowDown:I("vert",1),"Shift-ArrowLeft":O("horiz",-1),"Shift-ArrowRight":O("horiz",1),"Shift-ArrowUp":O("vert",-1),"Shift-ArrowDown":O("vert",1),Backspace:P,"Mod-Backspace":P,Delete:P,"Mod-Delete":P});function j(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function I(t,e){return(n,o,l)=>{if(!l)return!1;const r=n.selection;if(r instanceof b)return j(n,o,z.near(r.$headCell,e));if(t!="horiz"&&!r.empty)return!1;const s=Ne(l,t,e);if(s==null)return!1;if(t=="horiz")return j(n,o,z.near(n.doc.resolve(r.head+e),e));{const i=n.doc.resolve(s),a=Se(i,t,e);let c;return a?c=z.near(a,1):e<0?c=z.near(n.doc.resolve(i.before(-1)),-1):c=z.near(n.doc.resolve(i.after(-1)),1),j(n,o,c)}}}function O(t,e){return(n,o,l)=>{if(!l)return!1;const r=n.selection;let s;if(r instanceof b)s=r;else{const a=Ne(l,t,e);if(a==null)return!1;s=new b(n.doc.resolve(a))}const i=Se(s.$headCell,t,e);return i?j(n,o,new b(s.$anchorCell,i)):!1}}function yt(t,e){const n=t.state.doc,o=$(n.resolve(e));return o?(t.dispatch(t.state.tr.setSelection(new b(o))),!0):!1}function St(t,e,n){if(!M(t.state))return!1;let o=mt(n);const l=t.state.selection;if(l instanceof b){o||(o={width:1,height:1,rows:[T.from(te(y(t.state.schema).cell,n))]});const r=l.$anchorCell.node(-1),s=l.$anchorCell.start(-1),i=C.get(r).rectBetween(l.$anchorCell.pos-s,l.$headCell.pos-s);return o=wt(o,i.right-i.left,i.bottom-i.top),pe(t.state,t.dispatch,s,i,o),!0}else if(o){const r=q(t.state),s=r.start(-1);return pe(t.state,t.dispatch,s,C.get(r.node(-1)).findCell(r.pos-s),o),!0}else return!1}function At(t,e){var n;if(e.ctrlKey||e.metaKey)return;const o=he(t,e.target);let l;if(e.shiftKey&&t.state.selection instanceof b)r(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&o&&(l=$(t.state.selection.$anchor))!=null&&((n=J(t,e))==null?void 0:n.pos)!=l.pos)r(l,e),e.preventDefault();else if(!o)return;function r(a,c){let d=J(t,c);const f=H.getState(t.state)==null;if(!d||!re(a,d))if(f)d=a;else return;const u=new b(a,d);if(f||!t.state.selection.eq(u)){const h=t.state.tr.setSelection(u);f&&h.setMeta(H,a.pos),t.dispatch(h)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",i),H.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(H,-1))}function i(a){const c=a,d=H.getState(t.state);let f;if(d!=null)f=t.state.doc.resolve(d);else if(he(t,c.target)!=o&&(f=J(t,e),!f))return s();f&&r(f,c)}t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",i)}function Ne(t,e,n){if(!(t.state.selection instanceof k))return null;const{$head:o}=t.state.selection;for(let l=o.depth-1;l>=0;l--){const r=o.node(l);if((n<0?o.index(l):o.indexAfter(l))!=(n<0?0:r.childCount))return null;if(r.type.spec.tableRole=="cell"||r.type.spec.tableRole=="header_cell"){const i=o.before(l),a=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(a)?i:null}}return null}function he(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function J(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?$(t.state.doc.resolve(n.pos)):null}var Rt=class{constructor(e,n){this.node=e,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ne(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,ne(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function ne(t,e,n,o,l,r){var s;let i=0,a=!0,c=e.firstChild;const d=t.firstChild;if(d){for(let f=0,u=0;f<d.childCount;f++){const{colspan:h,colwidth:p}=d.child(f).attrs;for(let g=0;g<h;g++,u++){const m=l==u?r:p&&p[g],w=m?m+"px":"";if(i+=m||o,m||(a=!1),c)c.style.width!=w&&(c.style.width=w),c=c.nextSibling;else{const S=document.createElement("col");S.style.width=w,e.appendChild(S)}}}for(;c;){const f=c.nextSibling;(s=c.parentNode)==null||s.removeChild(c),c=f}a?(n.style.width=i+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=i+"px")}}var A=new le("tableColumnResizing");function xt({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:o=Rt,lastColumnResizable:l=!0}={}){const r=new ye({key:A,state:{init(s,i){var a,c;const d=(c=(a=r.spec)==null?void 0:a.props)==null?void 0:c.nodeViews,f=y(i.schema).table.name;return o&&d&&(d[f]=(u,h)=>new o(u,n,h)),new Mt(-1,!1)},apply(s,i){return i.apply(s)}},props:{attributes:s=>{const i=A.getState(s);return i&&i.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(s,i)=>{Tt(s,i,t,l)},mouseleave:s=>{vt(s)},mousedown:(s,i)=>{Nt(s,i,e,n)}},decorations:s=>{const i=A.getState(s);if(i&&i.activeHandle>-1)return Lt(s,i.activeHandle)},nodeViews:{}}});return r}var Mt=class V{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,o=e.getMeta(A);if(o&&o.setHandle!=null)return new V(o.setHandle,!1);if(o&&o.setDragging!==void 0)return new V(n.activeHandle,o.setDragging);if(n.activeHandle>-1&&e.docChanged){let l=e.mapping.map(n.activeHandle,-1);return ee(e.doc.resolve(l))||(l=-1),new V(l,n.dragging)}return n}};function Tt(t,e,n,o){if(!t.editable)return;const l=A.getState(t.state);if(l&&!l.dragging){const r=Et(e.target);let s=-1;if(r){const{left:i,right:a}=r.getBoundingClientRect();e.clientX-i<=n?s=me(t,e,"left",n):a-e.clientX<=n&&(s=me(t,e,"right",n))}if(s!=l.activeHandle){if(!o&&s!==-1){const i=t.state.doc.resolve(s),a=i.node(-1),c=C.get(a),d=i.start(-1);if(c.colCount(i.pos-d)+i.nodeAfter.attrs.colspan-1==c.width-1)return}ze(t,s)}}}function vt(t){if(!t.editable)return;const e=A.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&ze(t,-1)}function Nt(t,e,n,o){var l;if(!t.editable)return!1;const r=(l=t.dom.ownerDocument.defaultView)!=null?l:window,s=A.getState(t.state);if(!s||s.activeHandle==-1||s.dragging)return!1;const i=t.state.doc.nodeAt(s.activeHandle),a=zt(t,s.activeHandle,i.attrs);t.dispatch(t.state.tr.setMeta(A,{setDragging:{startX:e.clientX,startWidth:a}}));function c(f){r.removeEventListener("mouseup",c),r.removeEventListener("mousemove",d);const u=A.getState(t.state);u?.dragging&&(Ht(t,u.activeHandle,ge(u.dragging,f,n)),t.dispatch(t.state.tr.setMeta(A,{setDragging:null})))}function d(f){if(!f.which)return c(f);const u=A.getState(t.state);if(u&&u.dragging){const h=ge(u.dragging,f,n);we(t,u.activeHandle,h,o)}}return we(t,s.activeHandle,a,o),r.addEventListener("mouseup",c),r.addEventListener("mousemove",d),e.preventDefault(),!0}function zt(t,e,{colspan:n,colwidth:o}){const l=o&&o[o.length-1];if(l)return l;const r=t.domAtPos(e);let i=r.node.childNodes[r.offset].offsetWidth,a=n;if(o)for(let c=0;c<n;c++)o[c]&&(i-=o[c],a--);return i/a}function Et(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function me(t,e,n,o){const l=n=="right"?-o:o,r=t.posAtCoords({left:e.clientX+l,top:e.clientY});if(!r)return-1;const{pos:s}=r,i=$(t.state.doc.resolve(s));if(!i)return-1;if(n=="right")return i.pos;const a=C.get(i.node(-1)),c=i.start(-1),d=a.map.indexOf(i.pos-c);return d%a.width==0?-1:c+a.map[d-1]}function ge(t,e,n){const o=e.clientX-t.startX;return Math.max(n,t.startWidth+o)}function ze(t,e){t.dispatch(t.state.tr.setMeta(A,{setHandle:e}))}function Ht(t,e,n){const o=t.state.doc.resolve(e),l=o.node(-1),r=C.get(l),s=o.start(-1),i=r.colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1,a=t.state.tr;for(let c=0;c<r.height;c++){const d=c*r.width+i;if(c&&r.map[d]==r.map[d-r.width])continue;const f=r.map[d],u=l.nodeAt(f).attrs,h=u.colspan==1?0:i-r.colCount(f);if(u.colwidth&&u.colwidth[h]==n)continue;const p=u.colwidth?u.colwidth.slice():kt(u.colspan);p[h]=n,a.setNodeMarkup(s+f,null,{...u,colwidth:p})}a.docChanged&&t.dispatch(a)}function we(t,e,n,o){const l=t.state.doc.resolve(e),r=l.node(-1),s=l.start(-1),i=C.get(r).colCount(l.pos-s)+l.nodeAfter.attrs.colspan-1;let a=t.domAtPos(l.start(-1)).node;for(;a&&a.nodeName!="TABLE";)a=a.parentNode;a&&ne(r,a.firstChild,a,o,i,n)}function kt(t){return Array(t).fill(0)}function Lt(t,e){var n;const o=[],l=t.doc.resolve(e),r=l.node(-1);if(!r)return Y.empty;const s=C.get(r),i=l.start(-1),a=s.colCount(l.pos-i)+l.nodeAfter.attrs.colspan-1;for(let c=0;c<s.height;c++){const d=a+c*s.width;if((a==s.width-1||s.map[d]!=s.map[d+1])&&(c==0||s.map[d]!=s.map[d-s.width])){const f=s.map[d],u=i+f+r.nodeAt(f).nodeSize-1,h=document.createElement("div");h.className="column-resize-handle",(n=A.getState(t))!=null&&n.dragging&&o.push(G.node(i+f,i+f+r.nodeAt(f).nodeSize,{class:"column-resize-dragging"})),o.push(G.widget(u,h))}}return Y.create(t.doc,o)}function Wt({allowTableNodeSelection:t=!1}={}){return new ye({key:H,state:{init(){return null},apply(e,n){const o=e.getMeta(H);if(o!=null)return o==-1?null:o;if(n==null||!e.docChanged)return n;const{deleted:l,pos:r}=e.mapping.mapResult(n);return l?null:r}},props:{decorations:qe,handleDOMEvents:{mousedown:At},createSelectionBetween(e){return H.getState(e.state)!=null?e.state.selection:null},handleTripleClick:yt,handleKeyDown:Ct,handlePaste:St},appendTransaction(e,n,o){return Ye(o,Me(o,n),t)}})}var $t=K.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,n;const o=t.getAttribute("colwidth"),l=o?o.split(",").map(r=>parseInt(r,10)):null;if(!l){const r=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),s=Array.from(((n=t.parentElement)==null?void 0:n.children)||[]).indexOf(t);if(s&&s>-1&&r&&r[s]){const i=r[s].getAttribute("width");return i?[parseInt(i,10)]:null}}return l}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",X(this.options.HTMLAttributes,t),0]}}),Dt=K.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(o=>parseInt(o,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",X(this.options.HTMLAttributes,t),0]}}),_t=K.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",X(this.options.HTMLAttributes,t),0]}});function oe(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function be(t,e,n,o,l,r){var s;let i=0,a=!0,c=e.firstChild;const d=t.firstChild;if(d!==null)for(let u=0,h=0;u<d.childCount;u+=1){const{colspan:p,colwidth:g}=d.child(u).attrs;for(let m=0;m<p;m+=1,h+=1){const w=l===h?r:g&&g[m],S=w?`${w}px`:"";if(i+=w||o,w||(a=!1),c){if(c.style.width!==S){const[R,E]=oe(o,w);c.style.setProperty(R,E)}c=c.nextSibling}else{const R=document.createElement("col"),[E,x]=oe(o,w);R.style.setProperty(E,x),e.appendChild(R)}}}for(;c;){const u=c.nextSibling;(s=c.parentNode)==null||s.removeChild(c),c=u}const f=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);a&&!f?(n.style.width=`${i}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${i}px`)}var Bt=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),be(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,be(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,n=this.dom.contains(e),o=this.contentDOM.contains(e);return!!(n&&!o&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function Pt(t,e,n,o){let l=0,r=!0;const s=[],i=t.firstChild;if(!i)return{};for(let f=0,u=0;f<i.childCount;f+=1){const{colspan:h,colwidth:p}=i.child(f).attrs;for(let g=0;g<h;g+=1,u+=1){const m=n===u?o:p&&p[g];l+=m||e,m||(r=!1);const[w,S]=oe(e,m);s.push(["col",{style:`${w}: ${S}`}])}}const a=r?`${l}px`:"",c=r?"":`${l}px`;return{colgroup:["colgroup",{},...s],tableWidth:a,tableMinWidth:c}}function Ce(t,e){return e?t.createChecked(null,e):t.createAndFill()}function It(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const o=t.nodes[n];o.spec.tableRole&&(e[o.spec.tableRole]=o)}),t.cached.tableNodeTypes=e,e}function Ot(t,e,n,o,l){const r=It(t),s=[],i=[];for(let c=0;c<n;c+=1){const d=Ce(r.cell,l);if(d&&i.push(d),o){const f=Ce(r.header_cell,l);f&&s.push(f)}}const a=[];for(let c=0;c<e;c+=1)a.push(r.row.createChecked(null,o&&c===0?s:i));return r.table.createChecked(null,a)}function Ft(t){return t instanceof b}var F=({editor:t})=>{const{selection:e}=t.state;if(!Ft(e))return!1;let n=0;const o=_e(e.ranges[0].$from,r=>r.type.name==="table");return o?.node.descendants(r=>{if(r.type.name==="table")return!1;["tableCell","tableHeader"].includes(r.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},jt="";function Vt(t){return(t||"").replace(/\s+/g," ").trim()}function Kt(t,e,n={}){var o;const l=(o=n.cellLineSeparator)!=null?o:jt;if(!t||!t.content||t.content.length===0)return"";const r=[];t.content.forEach(p=>{const g=[];p.content&&p.content.forEach(m=>{let w="";m.content&&Array.isArray(m.content)&&m.content.length>1?w=m.content.map(x=>e.renderChildren(x)).join(l):w=m.content?e.renderChildren(m.content):"";const S=Vt(w),R=m.type==="tableHeader";g.push({text:S,isHeader:R})}),r.push(g)});const s=r.reduce((p,g)=>Math.max(p,g.length),0);if(s===0)return"";const i=new Array(s).fill(0);r.forEach(p=>{var g;for(let m=0;m<s;m+=1){const S=(((g=p[m])==null?void 0:g.text)||"").length;S>i[m]&&(i[m]=S),i[m]<3&&(i[m]=3)}});const a=(p,g)=>p+" ".repeat(Math.max(0,g-p.length)),c=r[0],d=c.some(p=>p.isHeader);let f=`
`;const u=new Array(s).fill(0).map((p,g)=>d&&c[g]&&c[g].text||"");return f+=`| ${u.map((p,g)=>a(p,i[g])).join(" | ")} |
`,f+=`| ${i.map(p=>"-".repeat(Math.max(3,p))).join(" | ")} |
`,(d?r.slice(1):r).forEach(p=>{f+=`| ${new Array(s).fill(0).map((g,m)=>a(p[m]&&p[m].text||"",i[m])).join(" | ")} |
`}),f}var Xt=Kt,qt=K.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:Bt,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:o,tableMinWidth:l}=Pt(t,this.options.cellMinWidth),r=e.style;function s(){return r||(o?`width: ${o}`:`min-width: ${l}`)}const i=["table",X(this.options.HTMLAttributes,e,{style:s()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},i]:i},parseMarkdown:(t,e)=>{const n=[];if(t.header){const o=[];t.header.forEach(l=>{o.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(l.tokens)}]))}),n.push(e.createNode("tableRow",{},o))}return t.rows&&t.rows.forEach(o=>{const l=[];o.forEach(r=>{l.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(r.tokens)}]))}),n.push(e.createNode("tableRow",{},l))}),e.createNode("table",void 0,n)},renderMarkdown:(t,e)=>Xt(t,e),addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:o,dispatch:l,editor:r})=>{const s=Ot(r.schema,t,e,n);if(l){const i=o.selection.from+1;o.replaceSelectionWith(s).scrollIntoView().setSelection(k.near(o.doc.resolve(i)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>Ze(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>et(t,e),deleteColumn:()=>({state:t,dispatch:e})=>nt(t,e),addRowBefore:()=>({state:t,dispatch:e})=>lt(t,e),addRowAfter:()=>({state:t,dispatch:e})=>rt(t,e),deleteRow:()=>({state:t,dispatch:e})=>it(t,e),deleteTable:()=>({state:t,dispatch:e})=>ht(t,e),mergeCells:()=>({state:t,dispatch:e})=>ie(t,e),splitCell:()=>({state:t,dispatch:e})=>ce(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>_("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>_("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>ut(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>ie(t,e)?!0:ce(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:o})=>dt(t,e)(n,o),goToNextCell:()=>({state:t,dispatch:e})=>de(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>de(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Me(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const o=b.create(e.doc,t.anchorCell,t.headCell);e.setSelection(o)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:F,"Mod-Backspace":F,Delete:F,"Mod-Delete":F}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[xt({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Wt({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:$e(De(t,"tableRole",e))}}}),mn=We.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(qt.configure(this.options.table)),this.options.tableCell!==!1&&t.push($t.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(Dt.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(_t.configure(this.options.tableRow)),t}});export{jt as DEFAULT_CELL_LINE_SEPARATOR,qt as Table,$t as TableCell,Dt as TableHeader,mn as TableKit,_t as TableRow,Bt as TableView,Pt as createColGroup,Ot as createTable,Kt as renderTableToMarkdown,be as updateColumns};
