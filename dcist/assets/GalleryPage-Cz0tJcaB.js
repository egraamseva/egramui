import{x as H,r,V as h,t as i,W as Y,j as e,B as x,C as F,b as U}from"./index-B5GP4ZU0.js";import{I as A}from"./input-C4RtHFee.js";import{L as f}from"./label-k4a1c30R.js";import{T as $}from"./textarea-DqFXOEs1.js";import{S as J,a as K,b as Q,c as X,d as k}from"./select-dEcH2o1V.js";import{D as Z,a as _,b as ee,c as ae,d as te,e as se}from"./dialog-D8fBtqfZ.js";import{I as le}from"./ImageWithFallback-CPTj3iC7.js";import{I as re}from"./image-modal-c-Ha-HLI.js";import{C as ie}from"./circle-plus-B8nn-p_t.js";import{S as oe,T as ne}from"./trash-2-Dvt3QX8d.js";import"./check-BfJ-MShT.js";function je(){const{user:n}=H(),[m,C]=r.useState([]),[y,L]=r.useState([]),[R,S]=r.useState(!0),[O,b]=r.useState(!1),[u,j]=r.useState(null),[l,c]=r.useState({imageUrl:"",caption:"",tags:"",albumId:""}),[o,g]=r.useState(null),[D,p]=r.useState(""),[T,E]=r.useState(!1),[v,P]=r.useState(0);r.useEffect(()=>{n?.panchayatId&&(I(),z())},[n]);const I=async()=>{if(n?.panchayatId){S(!0);try{const a=await h.list();C(a.items)}catch(a){console.error("Error fetching images:",a),i.error("Failed to load images")}finally{S(!1)}}},z=async()=>{if(n?.panchayatId)try{const a=await Y.list();L(a.items)}catch(a){console.error("Error fetching albums:",a)}},B=()=>{j(null),c({imageUrl:"",caption:"",tags:"",albumId:""}),g(null),p(""),b(!0)},G=async a=>{j(a);let s="";try{if(!n?.panchayatId)return;const t=await h.getById(a.id);if(t?.albumId)s=String(t.albumId);else if(a.category){const d=y.find(w=>w.title===a.category);d&&(s=d.id)}}catch(t){if(console.error("Error fetching image details:",t),a.category){const d=y.find(w=>w.title===a.category);d&&(s=d.id)}}c({imageUrl:a.image,caption:a.title||"",tags:"",albumId:s}),g(null),p(""),b(!0)},N=()=>{b(!1),j(null),c({imageUrl:"",caption:"",tags:"",albumId:""}),g(null),p("")},M=async a=>{if(a?.preventDefault(),!!n?.panchayatId){if(!o&&!l.imageUrl.trim()){i.error("Please upload an image file or enter image URL");return}try{const s=l.albumId&&l.albumId!=="none"?parseInt(l.albumId):void 0,t={caption:l.caption||void 0,tags:l.tags||void 0,albumId:s};o?t.imageFile=o:t.imageUrl=l.imageUrl,await h.create(t),i.success("Image uploaded successfully!"),N(),I()}catch(s){const t=s instanceof Error?s.message:"Failed to upload image";i.error(t)}}},V=async a=>{if(a?.preventDefault(),!(!n?.panchayatId||!u)){if(!o&&!l.imageUrl.trim()){i.error("Please upload an image file or enter image URL");return}try{const s=l.albumId&&l.albumId!=="none"?parseInt(l.albumId):void 0,t={caption:l.caption||void 0,tags:l.tags||void 0,albumId:s};o?t.imageFile=o:t.imageUrl=l.imageUrl,await h.update(u.id,t),i.success("Image updated successfully!"),N(),I()}catch(s){const t=s instanceof Error?s.message:"Failed to update image";i.error(t)}}},W=async a=>{if(n?.panchayatId&&confirm("Are you sure you want to delete this image?"))try{await h.delete(a),C(s=>s.filter(t=>t.id!==a)),i.success("Image deleted successfully!")}catch(s){const t=s instanceof Error?s.message:"Failed to delete image";i.error(t)}},q=a=>{const s=a.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/")){i.error("Please select a valid image file");return}g(s);const t=new FileReader;t.onload=d=>{p(d.target?.result)},t.readAsDataURL(s)};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Photo Gallery"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Upload and manage photos"})]}),e.jsxs(x,{className:"bg-[#FF9933] hover:bg-[#FF9933]/90 w-full sm:w-auto",onClick:B,children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Upload Photos"})]})]}),R?e.jsx(F,{children:e.jsx(U,{className:"p-6 text-center text-muted-foreground text-sm",children:"Loading images..."})}):m.length===0?e.jsx(F,{children:e.jsx(U,{className:"p-6 text-center text-muted-foreground text-sm",children:"No images yet. Upload your first image!"})}):e.jsx(F,{children:e.jsx(U,{className:"p-3 sm:p-6",children:e.jsx("div",{className:"grid gap-3 sm:gap-4 grid-cols-2 sm:grid-cols-3 lg:grid-cols-4",children:m.map((a,s)=>e.jsxs("div",{className:"group relative aspect-square overflow-hidden rounded-lg border bg-muted cursor-pointer",onClick:()=>{P(s),E(!0)},children:[e.jsx("div",{className:"w-full h-full pointer-events-none",children:e.jsx(le,{src:a.image,alt:a.title,className:"w-full h-full object-cover"})}),a.category&&e.jsx("div",{className:"absolute top-2 left-2 bg-black/70 text-white text-xs px-2 py-1 rounded z-10 pointer-events-none",children:a.category}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center gap-1 sm:gap-2 bg-black/50 opacity-0 transition-opacity group-hover:opacity-100 group-active:opacity-100 z-10 pointer-events-none",children:[e.jsx(x,{variant:"secondary",size:"icon",className:"h-7 w-7 sm:h-9 sm:w-9 pointer-events-auto",onClick:t=>{t.stopPropagation(),G(a)},children:e.jsx(oe,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx(x,{variant:"secondary",size:"icon",className:"h-7 w-7 sm:h-9 sm:w-9 pointer-events-auto",onClick:t=>{t.stopPropagation(),W(a.id)},children:e.jsx(ne,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]})]},a.id))})})}),e.jsx(Z,{open:O,onOpenChange:b,children:e.jsxs(_,{className:"max-w-2xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsxs(ee,{children:[e.jsx(ae,{children:u?"Edit Image":"Upload New Image"}),e.jsx(te,{children:u?"Update the image details below":"Enter the image URL and details"})]}),e.jsxs("form",{onSubmit:a=>{a.preventDefault(),u?V(a):M(a)},className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"imageUrl",children:"Image URL or File *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{id:"imageUrl",placeholder:"Enter image URL (or upload file below)",value:l.imageUrl,onChange:a=>c({...l,imageUrl:a.target.value}),disabled:!!o}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"imageFile",type:"file",accept:"image/*",onChange:q,className:"hidden"}),e.jsx(f,{htmlFor:"imageFile",className:"flex items-center justify-center w-full px-3 py-2 border border-dashed border-input rounded-md cursor-pointer hover:bg-muted transition-colors",children:o?`âœ“ ${o.name}`:"Click to upload image file"})]}),D&&e.jsxs("div",{className:"relative w-full h-40 rounded-md overflow-hidden bg-muted",children:[e.jsx("img",{src:D,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>{g(null),p("")},className:"absolute top-2 right-2 px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600",children:"Remove"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"caption",children:"Caption"}),e.jsx($,{id:"caption",placeholder:"Enter image caption",value:l.caption,onChange:a=>c({...l,caption:a.target.value}),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"tags",children:"Tags (comma-separated)"}),e.jsx(A,{id:"tags",placeholder:"e.g., event, meeting, celebration",value:l.tags,onChange:a=>c({...l,tags:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"albumId",children:"Album (Optional)"}),e.jsxs(J,{value:l.albumId,onValueChange:a=>c({...l,albumId:a}),children:[e.jsx(K,{id:"albumId",children:e.jsx(Q,{placeholder:"Select an album (optional)"})}),e.jsxs(X,{children:[e.jsx(k,{value:"none",children:"No Album"}),y.map(a=>e.jsx(k,{value:a.id,children:a.title},a.id))]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Organize this image into an album. You can create albums from the Albums page."})]}),e.jsxs(se,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:N,children:"Cancel"}),e.jsx(x,{type:"submit",className:"bg-[#FF9933] hover:bg-[#FF9933]/90",children:u?"Update":"Upload"})]})]})]})}),m.length>0&&e.jsx(re,{isOpen:T,onClose:()=>E(!1),imageUrl:m[v]?.image||"",alt:m[v]?.title||"Gallery image",images:m.map(a=>a.image),currentIndex:v,onIndexChange:P})]})}export{je as GalleryPage};
