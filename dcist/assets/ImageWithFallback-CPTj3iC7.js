import{r as y,j as I}from"./index-B5GP4ZU0.js";async function U(r){return new Promise((a,i)=>{const e=new FileReader;e.onload=()=>{typeof e.result=="string"?a(e.result):i(new Error("Failed to convert file to data URL"))},e.onerror=()=>{i(new Error("Error reading file"))},e.readAsDataURL(r)})}function d(r){return r&&typeof r=="string"&&r.startsWith("blob:")}function R(r){return r&&typeof r=="string"&&r.startsWith("data:")}function h(r){return!r||typeof r!="string"?!1:(r.startsWith("http://")||r.startsWith("https://"))&&!d(r)}function w(r){if(!r)return r;if(Array.isArray(r))return r.map(a=>w(a));if(typeof r=="object"){const a={};for(const i in r)if(r.hasOwnProperty(i)){const e=r[i];(i==="image"||i==="imageUrl"||i==="backgroundImage"||i==="coverImage"||i==="logoUrl"||i==="heroImage"||i==="src"||i==="url")&&typeof e=="string"?d(e)||R(e)?(console.warn(`Removed temporary URL (blob/data) from ${i}:`,e.substring(0,50)+"..."),a[i]=null):h(e)?a[i]=e:e.trim()===""||e==="null"||e==="undefined"?a[i]=null:e.includes("/")||e.includes(".")?(console.warn(`Preserving potentially valid URL in ${i} (not http/https):`,e.substring(0,50)),a[i]=e):(console.warn(`Invalid URL format in ${i}, setting to null:`,e.substring(0,50)),a[i]=null):a[i]=w(e)}return a}return r}function P(r){if(!r)return r;let a=r;if(typeof r=="string"&&r.trim().startsWith("{"))try{a=JSON.parse(r)}catch(e){return console.warn("Failed to parse content as JSON, using as-is:",e),r}const i=w(a);if(i&&typeof i=="object"&&i.image){const e=i.image;typeof e=="string"&&(d(e)||R(e)?(console.warn("Removed temporary URL from content.image:",e.substring(0,50)+"..."),i.image=null):h(e)?i.image=e:e.trim()===""||e==="null"?i.image=null:(console.warn("Unusual URL format in content.image, preserving:",e.substring(0,50)),i.image=e))}return i&&i.items&&Array.isArray(i.items)&&(i.items=i.items.map(e=>e&&typeof e=="object"?(e.image&&typeof e.image=="string"&&(d(e.image)||R(e.image)?(console.warn("Removed temporary URL from item image:",e.image.substring(0,50)+"..."),e.image=null):!h(e.image)&&e.image.trim()!==""&&e.image!=="null"?console.warn("Unusual URL format in item image, preserving:",e.image.substring(0,50)):(e.image.trim()===""||e.image==="null")&&(e.image=null)),w(e)):e)),i}async function F(r,a=10*1024*1024){return new Promise((i,e)=>{if(!r){e(new Error("No file provided"));return}if(!r.type||!r.type.startsWith("image/")){e(new Error(`Invalid file type: ${r.type||"unknown"}. Please select an image file (JPEG, PNG, GIF, or WebP).`));return}if(r.size===0){e(new Error("File is empty. Please select a valid image file."));return}if(r.size>a){const m=(a/1048576).toFixed(1);e(new Error(`File size (${(r.size/(1024*1024)).toFixed(1)}MB) exceeds maximum allowed size of ${m}MB.`));return}const f=r.name.toLowerCase(),u=f.substring(f.lastIndexOf(".")+1),c=r.type.toLowerCase(),s={"image/jpeg":["jpg","jpeg"],"image/png":["png"],"image/gif":["gif"],"image/webp":["webp"]}[c];s&&!s.includes(u)&&console.warn(`File extension (${u}) doesn't match MIME type (${c}). This may cause issues.`);const n=new FileReader,t=new Image;let l=!1,g=!1;const b=()=>{l&&g&&(t.width>0&&t.height>0?(console.log(`âœ… Image validation passed: ${r.name} (${t.width}x${t.height}, ${r.size} bytes)`),i()):e(new Error("Image appears to be corrupted or invalid. Please select a different image file.")))};n.onload=m=>{g=!0,m.target?.result?(t.onload=()=>{l=!0,b()},t.onerror=()=>{e(new Error("Failed to load image. The file may be corrupted or in an unsupported format. Please try a different image file."))},t.src=m.target.result):e(new Error("Failed to read file. Please try again."))},n.onerror=()=>{e(new Error("Error reading file. Please try again."))},n.readAsDataURL(r),setTimeout(()=>{(!l||!g)&&e(new Error("Image validation timed out. The file may be too large or corrupted."))},1e4)})}const E="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==";function j(r){const{src:a,alt:i,style:e,className:f,...u}=r,[c,o]=y.useState(!1),[s,n]=y.useState(a||void 0),[t,l]=y.useState(0),g=2;y.useEffect(()=>{a&&!d(a)?(n(a),o(!1),l(0)):a&&d(a)?(console.warn("Blob URL detected in ImageWithFallback, ignoring:",a),n(void 0),o(!0)):n(void 0)},[a]);const b=()=>{o(!1),l(0)},m=x=>{x.currentTarget;const p=s||"";if(d(p)){console.warn("Blob URL expired or revoked:",p),o(!0);return}if(t>=g){console.error("Image load failed after retries:",p),o(!0);return}console.warn(`Image load error (attempt ${t+1}/${g+1}):`,p),t<g?setTimeout(()=>{if(l(v=>v+1),s&&!s.startsWith("data:")){const v=s.includes("?")?"&":"?";n(`${s}${v}_retry=${Date.now()}`)}else n(s)},1e3*(t+1)):o(!0)};return c||!s?I.jsx("div",{className:`inline-block bg-[#F5F5F5] text-center align-middle ${f??""}`,style:e,children:I.jsx("div",{className:"flex items-center justify-center w-full h-full",children:I.jsx("img",{src:E,alt:i||"Error loading image",...u})})}):I.jsx("img",{src:s,alt:i,className:f,style:e,...u,onError:m,onLoad:b})}export{j as I,w as c,U as f,d as i,P as p,F as v};
