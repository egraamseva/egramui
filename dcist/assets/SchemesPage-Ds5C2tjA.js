import{x as B,r as o,T as u,t as r,j as e,B as m,C,b as w,d as k,e as L,f as q}from"./index-B5GP4ZU0.js";import{I as y}from"./input-C4RtHFee.js";import{L as x}from"./label-k4a1c30R.js";import{T as O}from"./textarea-DqFXOEs1.js";import{D as U,a as z,b as H,c as M,d as R,e as G}from"./dialog-D8fBtqfZ.js";import{P as J}from"./progress-B_j9cJD-.js";import{C as K}from"./circle-plus-B8nn-p_t.js";import{S as Q,T as V}from"./trash-2-Dvt3QX8d.js";function te(){const{user:n}=B(),[g,N]=o.useState([]),[S,v]=o.useState(!0),[D,h]=o.useState(!1),[l,p]=o.useState(null),[t,c]=o.useState({name:"",category:"",budget:"",beneficiaries:"",description:""});o.useEffect(()=>{n?.panchayatId&&f()},[n]);const f=async()=>{if(n?.panchayatId){v(!0);try{const s=await u.list();N(s.items)}catch(s){console.error("Error fetching schemes:",s),r.error("Failed to load schemes")}finally{v(!1)}}},E=()=>{p(null),c({name:"",category:"",budget:"",beneficiaries:"",description:""}),h(!0)},F=s=>{p(s),c({name:s.name,category:s.category,budget:s.budget.replace(/[₹,]/g,""),beneficiaries:s.beneficiaries.toString(),description:s.category}),h(!0)},b=()=>{h(!1),p(null),c({name:"",category:"",budget:"",beneficiaries:"",description:""})},I=async s=>{if(s?.preventDefault(),!n?.panchayatId)return;if(!t.name.trim()){r.error("Please enter scheme name");return}if(!t.category.trim()){r.error("Please enter scheme category/description");return}const a=t.budget?parseFloat(t.budget.replace(/[₹,]/g,"")):0,i=t.beneficiaries?parseInt(t.beneficiaries):0;try{await u.create({title:t.name,description:t.category,budgetAmount:a,beneficiaryCount:i}),r.success("Scheme created successfully!"),b(),f()}catch(d){const j=d instanceof Error?d.message:"Failed to create scheme";r.error(j)}},P=async s=>{if(s?.preventDefault(),!n?.panchayatId||!l)return;if(!t.name.trim()){r.error("Please enter scheme name");return}if(!t.category.trim()){r.error("Please enter scheme category/description");return}const a=t.budget?parseFloat(t.budget.replace(/[₹,]/g,"")):0,i=t.beneficiaries?parseInt(t.beneficiaries):0;try{await u.update(l.id,{title:t.name,description:t.category,budgetAmount:a,beneficiaryCount:i}),r.success("Scheme updated successfully!"),b(),f()}catch(d){const j=d instanceof Error?d.message:"Failed to update scheme";r.error(j)}},T=s=>{const a=g.find(i=>i.id===s);a&&F(a)},A=async s=>{if(n?.panchayatId&&confirm("Are you sure you want to delete this scheme?"))try{await u.delete(s),N(a=>a.filter(i=>i.id!==s)),r.success("Scheme deleted successfully!")}catch(a){const i=a instanceof Error?a.message:"Failed to delete scheme";r.error(i)}};return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:"Schemes Management"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Track and manage government schemes"})]}),e.jsxs(m,{className:"bg-[#138808] hover:bg-[#138808]/90 w-full sm:w-auto",onClick:E,children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Add Scheme"})]})]}),S?e.jsx("div",{className:"text-center text-muted-foreground py-8 text-sm",children:"Loading schemes..."}):e.jsx("div",{className:"grid gap-4 sm:gap-6",children:g.length===0?e.jsx(C,{children:e.jsx(w,{className:"p-6 text-center text-muted-foreground text-sm",children:"No schemes yet. Add your first scheme!"})}):g.map(s=>e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(L,{className:"text-base sm:text-lg",children:s.name}),e.jsxs(q,{className:"text-xs sm:text-sm",children:["Category: ",s.category]})]}),e.jsxs("div",{className:"flex gap-2 self-start sm:self-center",children:[e.jsx(m,{variant:"outline",size:"icon",className:"h-8 w-8 sm:h-10 sm:w-10",onClick:()=>T(s.id),children:e.jsx(Q,{className:"h-3 w-3 sm:h-4 sm:w-4"})}),e.jsx(m,{variant:"outline",size:"icon",className:"h-8 w-8 sm:h-10 sm:w-10",onClick:()=>A(s.id),children:e.jsx(V,{className:"h-3 w-3 sm:h-4 sm:w-4 text-destructive"})})]})]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Budget"}),e.jsx("p",{className:"text-sm sm:text-base text-[#138808] font-semibold mt-1",children:s.budget})]}),e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Beneficiaries"}),e.jsxs("p",{className:"text-sm sm:text-base text-[#138808] font-semibold mt-1",children:[s.beneficiaries," families"]})]}),e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Progress"}),e.jsxs("p",{className:"text-sm sm:text-base text-[#138808] font-semibold mt-1",children:[s.progress,"%"]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(J,{value:s.progress})})]})]},s.id))}),e.jsx(U,{open:D,onOpenChange:h,children:e.jsxs(z,{className:"max-w-2xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsxs(H,{children:[e.jsx(M,{children:l?"Edit Scheme":"Create New Scheme"}),e.jsx(R,{children:l?"Update the scheme details below":"Fill in the details to create a new scheme"})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),l?P(s):I(s)},className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"name",children:"Scheme Name *"}),e.jsx(y,{id:"name",placeholder:"Enter scheme name",value:t.name,onChange:s=>c({...t,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"category",children:"Category/Description *"}),e.jsx(O,{id:"category",placeholder:"Enter scheme category or description",value:t.category,onChange:s=>c({...t,category:s.target.value}),rows:3,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"budget",children:"Budget (₹)"}),e.jsx(y,{id:"budget",type:"number",placeholder:"Enter budget amount",value:t.budget,onChange:s=>c({...t,budget:s.target.value}),min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"beneficiaries",children:"Beneficiaries"}),e.jsx(y,{id:"beneficiaries",type:"number",placeholder:"Number of beneficiaries",value:t.beneficiaries,onChange:s=>c({...t,beneficiaries:s.target.value}),min:"0"})]})]}),e.jsxs(G,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:b,children:"Cancel"}),e.jsx(m,{type:"submit",className:"bg-[#138808] hover:bg-[#138808]/90",children:l?"Update":"Create"})]})]})]})})]})}export{te as SchemesPage};
